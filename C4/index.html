<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Math Adventure: Money Matters</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            max-width: 900px;
            width: 100%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            margin: 20px 0;
        }
        h1 {
            color: #19547b;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .subtitle {
            text-align: center;
            color: #ffd89b;
            background: #19547b;
            padding: 8px 15px;
            border-radius: 20px;
            margin-bottom: 30px;
            font-size: 1.2rem;
            display: inline-block;
        }
        .game-selector { display:flex; justify-content:center; gap:15px; margin-bottom:30px; flex-wrap:wrap }
        .game-btn {
            background: linear-gradient(to right, #19547b, #ffd89b);
            color: white; border: none; border-radius: 50px;
            padding: 12px 25px; font-size: 1.1rem; cursor:pointer;
            transition: all 0.3s ease; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .game-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.3) }
        .game-btn.active { background: linear-gradient(to right, #ff7e5f, #feb47b) }
        .game-area {
            background-color: #f8f9fa; border-radius: 15px; padding: 25px;
            min-height: 500px; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .game-title { color:#19547b; margin-bottom:20px; text-align:center }
        .problem-container {
            background: white; border-radius: 15px; padding: 25px;
            width:100%; max-width:600px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom:25px;
        }
        .problem-display { font-size:1.8rem; text-align:center; margin-bottom:20px; color:#333; line-height:1.5 }
        .coins-container { display:flex; justify-content:center; flex-wrap:wrap; gap:15px; margin:20px 0 }
        .coin {
            width:70px; height:70px; border-radius:50%; display:flex; align-items:center; justify-content:center;
            font-weight:bold; color:#333; cursor:pointer; transition: all 0.2s ease; box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            position: relative;
        }
        .coin:hover { transform: scale(1.1) }
        .coin.selected { transform: scale(1.15); box-shadow: 0 0 0 3px #ff7e5f; }
        .coin-5sen { background: linear-gradient(135deg, #b08d57, #d4af37) }
        .coin-10sen, .coin-20sen, .coin-50sen { background: linear-gradient(135deg, #c0c0c0, #e8e8e8) }
        .ringgit-bill {
            width:120px; height:60px; background: linear-gradient(135deg, #8cc63f, #6da22c);
            border-radius:5px; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2); cursor:pointer; transition: all 0.2s ease;
        }
        .ringgit-bill:hover { transform: scale(1.05) }
        .ringgit-bill.selected { transform: scale(1.1); box-shadow: 0 0 0 3px #ff7e5f }
        .money-input-container { display:flex; align-items:center; justify-content:center; gap:10px; margin:20px 0 }
        .ringgit-sign { font-size:2rem; font-weight:bold; color:#19547b }
        .money-input { width:120px; height:60px; font-size:2rem; text-align:center; border:2px solid #19547b; border-radius:10px }
        .change-container { display:flex; flex-direction:column; align-items:center; gap:15px; margin:20px 0 }
        .change-display {
            display:flex; gap:10px; flex-wrap:wrap; justify-content:center; min-height:80px; padding:15px;
            border:2px dashed #19547b; border-radius:10px; width:100%; max-width:400px;
        }
        .change-coin { width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:0.9rem; box-shadow:0 2px 4px rgba(0,0,0,0.2) }
        .change-bill { width:80px; height:40px; background: linear-gradient(135deg, #8cc63f, #6da22c); border-radius:3px; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; font-size:0.9rem; box-shadow:0 2px 4px rgba(0,0,0,0.2) }
        .money-controls { display:flex; gap:10px; justify-content:center; margin-top:15px }
        .money-btn { background:#19547b; color:white; border:none; border-radius:10px; padding:10px 20px; font-size:1.1rem; cursor:pointer }
        .money-btn:hover { background:#ff7e5f }
        .options-container { display:flex; gap:15px; margin:20px 0; flex-wrap:wrap; justify-content:center }
        .option-btn { background:white; border:2px solid #19547b; border-radius:10px; padding:12px 20px; font-size:1.2rem; cursor:pointer; transition:all 0.2s ease; min-width:100px }
        .option-btn:hover { background:#e6f0ff }
        .option-btn.correct { background:#4caf50; color:white; border-color:#4caf50 }
        .option-btn.incorrect { background:#f44336; color:white; border-color:#f44336 }
        .store-container { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin:20px 0 }
        .store-item { background:white; border:2px solid #19547b; border-radius:10px; padding:15px; text-align:center; width:140px; box-shadow:0 3px 6px rgba(0,0,0,0.1) }
        .item-price { font-weight:bold; color:#19547b; font-size:1.3rem; margin-top:10px }
        .item-image { font-size:3rem; margin-bottom:10px }
        .feedback { margin-top:20px; padding:15px; border-radius:10px; text-align:center; font-size:1.2rem; font-weight:bold; min-height:60px; display:flex; align-items:center; justify-content:center; width:100%; max-width:500px }
        .feedback.correct { background:#e8f5e9; color:#4caf50 }
        .feedback.incorrect { background:#ffebee; color:#f44336 }
        .action-btn { background: linear-gradient(to right, #ff7e5f, #feb47b); color:white; border:none; border-radius:50px; padding:12px 30px; font-size:1.2rem; cursor:pointer; margin-top:20px; transition:all 0.3s ease; box-shadow:0 4px 10px rgba(0,0,0,0.2) }
        .action-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.3) }
        .score-container { display:flex; justify-content:space-between; width:100%; margin-bottom:20px; font-size:1.2rem; font-weight:bold; color:#19547b }
        .wallet { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin:20px 0; padding:15px; border:2px solid #ffd89b; border-radius:10px; background:#fff9e6 }
        @media (max-width:600px) {
            .container { padding:15px }
            h1 { font-size:2rem }
            .game-btn { padding:10px 15px; font-size:1rem }
            .problem-display { font-size:1.5rem }
            .coin { width:60px; height:60px }
            .ringgit-bill { width:100px; height:50px }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Math Adventure</h1>
        <div class="subtitle">Money Matters (Malaysian Ringgit)</div>

        <div class="score-container">
            <div>Score: <span id="score">0</span></div>
            <div>Level: <span id="level">1</span></div>
            <div>Money Bag: RM<span id="moneyBag">0.00</span></div>
        </div>

        <div class="game-selector">
            <button class="game-btn active" data-game="counting">Coin Counter</button>
            <button class="game-btn" data-game="change">Change Maker</button>
            <button class="game-btn" data-game="problems">Money Problems</button>
        </div>

        <div class="game-area">
            <!-- Counting Game -->
            <div id="countingGame" class="game-content">
                <h2 class="game-title">Coin Counter</h2>
                <div class="problem-container">
                    <div class="problem-display" id="countingProblem">Berapa jumlah wang yang ditunjukkan?</div>

                    <div class="coins-container" id="coinsDisplay">
                        <!-- Coins and bills will be generated here -->
                    </div>

                    <div class="money-input-container">
                        <span class="ringgit-sign">RM</span>
                        <input type="text" class="money-input" id="countingInput" placeholder="0.00" />
                    </div>
                </div>

                <div class="options-container" id="countingOptions">
                    <!-- Options will be generated here -->
                </div>

                <div class="feedback" id="countingFeedback">Kira syiling dan wang kertas untuk mencari jumlah!</div>

                <button class="action-btn" id="checkCounting">Semak Jawapan</button>
            </div>

            <!-- Change Game -->
            <div id="changeGame" class="game-content" style="display: none;">
                <h2 class="game-title">Change Maker</h2>
                <div class="problem-container">
                    <div class="problem-display" id="changeProblem">Barangan berharga RM2.75. Anda bayar dengan RM5.00. Berapa baki yang patut anda terima?</div>

                    <div class="store-container">
                        <div class="store-item">
                            <div class="item-image">üçé</div>
                            <div>Epal</div>
                            <div class="item-price" id="itemPrice">RM2.75</div>
                        </div>
                    </div>

                    <div class="money-input-container">
                        <span>Anda bayar: RM</span>
                        <input type="text" class="money-input" id="paymentInput" placeholder="0.00" />
                    </div>

                    <div class="change-container">
                        <div>Baki anda sepatutnya: <span id="changeAmount">RM2.25</span></div>
                        <div>Pilih baki yang betul:</div>
                        <div class="change-display" id="changeSelection">
                            <!-- Change options will be generated here -->
                        </div>
                    </div>
                </div>

                <div class="feedback" id="changeFeedback">Kira baki dan pilih syiling dan wang kertas yang betul!</div>

                <button class="action-btn" id="checkChange">Semak Jawapan</button>
            </div>

            <!-- Problems Game -->
            <div id="problemsGame" class="game-content" style="display: none;">
                <h2 class="game-title">Money Problems</h2>
                <div class="problem-container">
                    <div class="problem-display" id="problemText">Sarah ada RM5.00. Dia beli mainan dengan harga RM3.25. Berapa duit yang tinggal?</div>

                    <div class="money-input-container">
                        <span class="ringgit-sign">RM</span>
                        <input type="text" class="money-input" id="problemInput" placeholder="0.00" />
                    </div>

                    <div class="wallet" id="problemWallet">
                        <!-- Wallet items will be shown here -->
                    </div>
                </div>

                <div class="options-container" id="problemOptions">
                    <!-- Options will be generated here -->
                </div>

                <div class="feedback" id="problemFeedback">Selesaikan masalah wang ini!</div>

                <button class="action-btn" id="checkProblem">Semak Jawapan</button>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let currentGame = 'counting';
        let score = 0;
        let level = 1;
        let moneyBag = 0;
        let currentProblem = {};
        let selectedCoins = [];

        // DOM elements
        const gameBtns = document.querySelectorAll('.game-btn');
        const gameContents = document.querySelectorAll('.game-content');
        const scoreElement = document.getElementById('score');
        const levelElement = document.getElementById('level');
        const moneyBagElement = document.getElementById('moneyBag');

        // Counting Game Elements
        const countingProblem = document.getElementById('countingProblem');
        const coinsDisplay = document.getElementById('coinsDisplay');
        const countingInput = document.getElementById('countingInput');
        const countingOptions = document.getElementById('countingOptions');
        const countingFeedback = document.getElementById('countingFeedback');
        const checkCountingBtn = document.getElementById('checkCounting');

        // Change Game Elements
        const changeProblem = document.getElementById('changeProblem');
        const itemPrice = document.getElementById('itemPrice');
        const paymentInput = document.getElementById('paymentInput');
        const changeAmount = document.getElementById('changeAmount');
        const changeSelection = document.getElementById('changeSelection');
        const changeFeedback = document.getElementById('changeFeedback');
        const checkChangeBtn = document.getElementById('checkChange');

        // Problems Game Elements
        const problemText = document.getElementById('problemText');
        const problemInput = document.getElementById('problemInput');
        const problemWallet = document.getElementById('problemWallet');
        const problemOptions = document.getElementById('problemOptions');
        const problemFeedback = document.getElementById('problemFeedback');
        const checkProblemBtn = document.getElementById('checkProblem');

        // Malaysian coin and bill values (in RM)
        const coinValues = {
            'coin-5sen': 0.05,
            'coin-10sen': 0.10,
            'coin-20sen': 0.20,
            'coin-50sen': 0.50,
            'ringgit1': 1.00,
            'ringgit5': 5.00,
            'ringgit10': 10.00
        };

        // Initialize the game
        function init() {
            // Set up game selector buttons
            gameBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const game = btn.getAttribute('data-game');
                    switchGame(game);

                    // Update active button
                    gameBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            // Set up check answer buttons
            checkCountingBtn.addEventListener('click', checkCounting);
            checkChangeBtn.addEventListener('click', checkChange);
            checkProblemBtn.addEventListener('click', checkProblem);

            // Set up input fields to check answer on Enter
            countingInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') checkCounting();
            });

            paymentInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') checkChange();
            });

            problemInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') checkProblem();
            });

            // Initialize first game
            switchGame('counting');
        }

        // Switch between games
        function switchGame(game) {
            currentGame = game;

            // Hide all game contents
            gameContents.forEach(content => {
                content.style.display = 'none';
            });

            // Show selected game
            const el = document.getElementById(`${game}Game`);
            if (el) el.style.display = 'flex';

            // Reset feedback
            document.querySelectorAll('.feedback').forEach(feedback => {
                feedback.className = 'feedback';
                if (game === 'counting') {
                    feedback.textContent = 'Kira syiling dan wang kertas untuk mencari jumlah!';
                } else if (game === 'change') {
                    feedback.textContent = 'Kira baki dan pilih syiling dan wang kertas yang betul!';
                } else {
                    feedback.textContent = 'Selesaikan masalah wang ini!';
                }
            });

            // Clear inputs and selections
            clearInputs();
            selectedCoins = [];

            // Generate new problem
            generateProblem();
        }

        // Clear all input fields
        function clearInputs() {
            countingInput.value = '';
            paymentInput.value = '';
            problemInput.value = '';

            // Reset option buttons
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.className = 'option-btn';
            });
        }

        // Generate a new problem based on current game and level
        function generateProblem() {
            if (currentGame === 'counting') {
                generateCountingProblem();
            } else if (currentGame === 'change') {
                generateChangeProblem();
            } else if (currentGame === 'problems') {
                generateMoneyProblem();
            }
        }

        // Generate a counting problem
        function generateCountingProblem() {
            // Clear previous coins
            coinsDisplay.innerHTML = '';

            // Determine number of coins/bills based on level
            const numItems = Math.min(3 + level, 8);
            let totalValue = 0;
            const coins = [];

            // Available coins/bills based on level
            let availableCoins = ['coin-5sen', 'coin-10sen', 'coin-20sen', 'coin-50sen'];
            if (level >= 3) availableCoins.push('ringgit1');
            if (level >= 5) availableCoins.push('ringgit5');
            if (level >= 7) availableCoins.push('ringgit10');

            // Generate random coins/bills
            for (let i = 0; i < numItems; i++) {
                const coinType = availableCoins[Math.floor(Math.random() * availableCoins.length)];
                coins.push(coinType);
                totalValue += coinValues[coinType];
            }

            currentProblem = {
                type: 'counting',
                coins: coins,
                total: Math.round(totalValue * 100) / 100 // Round to 2 decimal places
            };

            // Display the problem
            countingProblem.textContent = 'Berapa jumlah wang yang ditunjukkan?';

            // Create visual representation of coins/bills
            coins.forEach(coin => {
                const element = document.createElement('div');

                if (coin.includes('ringgit')) {
                    element.className = 'ringgit-bill';
                    element.textContent = `RM${coinValues[coin].toFixed(2)}`;
                    element.setAttribute('data-value', coinValues[coin]);
                } else {
                    element.className = `coin ${coin}`;
                    element.textContent = formatCoinName(coin);
                    element.setAttribute('data-value', coinValues[coin]);
                }

                coinsDisplay.appendChild(element);
            });

            // Generate multiple choice options
            generateCountingOptions();

            // Set focus to input
            countingInput.focus();
        }

        // Generate multiple choice options for counting
        function generateCountingOptions() {
            countingOptions.innerHTML = '';

            const correctOption = `RM${currentProblem.total.toFixed(2)}`;
            const options = [correctOption];

            // Generate incorrect options
            while (options.length < 4) {
                // Create plausible wrong answers
                let wrongValue;

                if (Math.random() > 0.5) {
                    // Add a little
                    wrongValue = currentProblem.total + (Math.random() * 0.5 + 0.1);
                } else {
                    // Subtract a little
                    wrongValue = Math.max(0.01, currentProblem.total - (Math.random() * 0.5 + 0.1));
                }

                wrongValue = Math.round(wrongValue * 100) / 100;
                const option = `RM${wrongValue.toFixed(2)}`;

                if (option !== correctOption && !options.includes(option)) {
                    options.push(option);
                }
            }

            // Shuffle options
            shuffleArray(options);

            // Create option buttons
            options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.addEventListener('click', () => {
                    countingInput.value = option.replace('RM', '');

                    // Highlight selected option
                    document.querySelectorAll('#countingOptions .option-btn').forEach(b => {
                        b.classList.remove('selected');
                    });
                    btn.classList.add('selected');
                });
                countingOptions.appendChild(btn);
            });
        }

        // Generate a change making problem
        function generateChangeProblem() {
            // Clear previous change options
            changeSelection.innerHTML = '';
            selectedCoins = [];

            // Generate random item price based on level
            const maxPrice = Math.min(5 + level * 2, 20);
            const price = Math.round((Math.random() * maxPrice + 0.5) * 100) / 100;

            // Generate payment amount (always more than price)
            const payment = Math.ceil(price) + Math.floor(Math.random() * 5);

            const change = Math.round((payment - price) * 100) / 100;

            currentProblem = {
                type: 'change',
                price: price,
                payment: payment,
                change: change
            };

            // Display the problem
            changeProblem.textContent = `Barangan berharga RM${price.toFixed(2)}. Anda bayar dengan RM${payment.toFixed(2)}. Berapa baki yang patut anda terima?`;
            itemPrice.textContent = `RM${price.toFixed(2)}`;
            paymentInput.value = payment.toFixed(2);
            changeAmount.textContent = `RM${change.toFixed(2)}`;

            // Generate change options
            generateChangeOptions();
        }

        // Generate change options for selection
        function generateChangeOptions() {
            // Clear previous options
            changeSelection.innerHTML = '';

            // Create correct change combination
            const correctChange = makeChange(currentProblem.change);

            // Create incorrect change combinations
            const incorrectChanges = [];
            while (incorrectChanges.length < 2) {
                // produce variation without going negative
                const variation = (Math.random() > 0.5 ? 0.5 : -0.5);
                const candidateAmount = Math.max(0, currentProblem.change + variation);
                const wrongChange = makeChange(Math.round(candidateAmount * 100) / 100);
                if (JSON.stringify(wrongChange) !== JSON.stringify(correctChange)) {
                    incorrectChanges.push(wrongChange);
                }
            }

            // Combine all options and shuffle
            const allOptions = [correctChange, ...incorrectChanges];
            shuffleArray(allOptions);

            // Create visual options
            allOptions.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'change-option';
                optionDiv.style.display = 'flex';
                optionDiv.style.flexWrap = 'wrap';
                optionDiv.style.gap = '5px';
                optionDiv.style.justifyContent = 'center';
                optionDiv.style.padding = '10px';
                optionDiv.style.border = '2px solid #19547b';
                optionDiv.style.borderRadius = '10px';
                optionDiv.style.cursor = 'pointer';
                optionDiv.style.transition = 'all 0.2s ease';

                optionDiv.addEventListener('click', () => {
                    // Store selected coins
                    selectedCoins = option;

                    // Highlight selected option
                    document.querySelectorAll('.change-option').forEach(opt => {
                        opt.style.backgroundColor = 'white';
                        opt.style.boxShadow = 'none';
                    });
                    optionDiv.style.backgroundColor = '#e6f0ff';
                    optionDiv.style.boxShadow = '0 0 0 3px #ff7e5f';
                });

                // Add coins to option
                option.forEach(coin => {
                    const coinElement = document.createElement('div');

                    if (coin >= 1) {
                        coinElement.className = 'change-bill';
                        coinElement.textContent = `RM${coin.toFixed(2)}`;
                    } else {
                        coinElement.className = 'change-coin';
                        coinElement.textContent = formatCoinValue(coin);

                        // Add color based on coin type
                        if (Math.abs(coin - 0.05) < 0.0001) coinElement.classList.add('coin-5sen');
                        else if (Math.abs(coin - 0.10) < 0.0001) coinElement.classList.add('coin-10sen');
                        else if (Math.abs(coin - 0.20) < 0.0001) coinElement.classList.add('coin-20sen');
                        else if (Math.abs(coin - 0.50) < 0.0001) coinElement.classList.add('coin-50sen');
                    }

                    optionDiv.appendChild(coinElement);
                });

                changeSelection.appendChild(optionDiv);

                // Store which option is correct
                if (JSON.stringify(option) === JSON.stringify(correctChange)) {
                    optionDiv.setAttribute('data-correct', 'true');
                }
            });
        }

        // Generate a money word problem
        function generateMoneyProblem() {
            // Clear previous wallet
            problemWallet.innerHTML = '';

            // Problem types
            const problemTypes = ['addition', 'subtraction', 'multiplication', 'division', 'comparison'];
            const problemType = problemTypes[Math.floor(Math.random() * problemTypes.length)];
            let problem, answer;

            // Generate problem based on type
            switch (problemType) {
                case 'addition':
                    const add1 = Math.round((Math.random() * 10 + 1) * 100) / 100;
                    const add2 = Math.round((Math.random() * 10 + 1) * 100) / 100;
                    problem = `Jika anda ada RM${add1.toFixed(2)} dan anda dapat RM${add2.toFixed(2)}, berapa duit yang anda ada sekarang?`;
                    answer = add1 + add2;
                    break;

                case 'subtraction':
                    const sub1 = Math.round((Math.random() * 10 + 5) * 100) / 100;
                    const sub2 = Math.round((Math.random() * 5 + 1) * 100) / 100;
                    problem = `Anda ada RM${sub1.toFixed(2)}. Anda belanja RM${sub2.toFixed(2)}. Berapa duit yang tinggal?`;
                    answer = sub1 - sub2;
                    break;

                case 'multiplication':
                    const mult1 = Math.round((Math.random() * 5 + 1) * 100) / 100;
                    const mult2 = Math.floor(Math.random() * 5 + 2);
                    problem = `Jika satu mainan berharga RM${mult1.toFixed(2)}, berapa harga ${mult2} mainan?`;
                    answer = mult1 * mult2;
                    break;

                case 'division':
                    const div1 = Math.round((Math.random() * 10 + 5) * 100) / 100;
                    const div2 = Math.floor(Math.random() * 3 + 2);
                    problem = `Anda ada RM${div1.toFixed(2)} untuk dikongsi sama rata antara ${div2} kawan. Berapa setiap kawan dapat?`;
                    answer = div1 / div2;
                    break;

                case 'comparison':
                    const comp1 = Math.round((Math.random() * 10 + 1) * 100) / 100;
                    const comp2 = Math.round((Math.random() * 10 + 1) * 100) / 100;
                    if (comp1 > comp2) {
                        problem = `John ada RM${comp1.toFixed(2)} dan Sarah ada RM${comp2.toFixed(2)}. Berapa lebih duit John?`;
                        answer = comp1 - comp2;
                    } else {
                        problem = `Sarah ada RM${comp2.toFixed(2)} dan John ada RM${comp1.toFixed(2)}. Berapa lebih duit Sarah?`;
                        answer = comp2 - comp1;
                    }
                    break;
            }

            currentProblem = {
                type: 'problem',
                problem: problem,
                answer: Math.round(answer * 100) / 100
            };

            // Display the problem
            problemText.textContent = problem;

            // Generate visual wallet representation
            generateWalletVisual();

            // Generate multiple choice options
            generateProblemOptions();

            // Set focus to input
            problemInput.focus();
        }

        // Generate wallet visual for money problems
        function generateWalletVisual() {
            // Create a visual representation of the money in the problem
            const amount = currentProblem.answer * 2 || 0; // Show roughly double for context

            // Use bills and coins to represent the amount
            let remaining = amount;
            const billsCoins = [];

            // Add bills
            const billValues = [10, 5, 1];
            billValues.forEach(bill => {
                const count = Math.floor(remaining / bill);
                for (let i = 0; i < count && i < 2; i++) { // Limit to 2 of each bill
                    billsCoins.push(bill);
                    remaining = Math.round((remaining - bill) * 100) / 100;
                }
            });

            // Add coins
            const coinVals = [0.50, 0.20, 0.10, 0.05];
            coinVals.forEach(coin => {
                const count = Math.floor(remaining / coin);
                for (let i = 0; i < count && i < 3; i++) { // Limit to 3 of each coin
                    billsCoins.push(coin);
                    remaining = Math.round((remaining - coin) * 100) / 100;
                }
            });

            // Display wallet
            billsCoins.forEach(item => {
                const element = document.createElement('div');

                if (item >= 1) {
                    element.className = 'ringgit-bill';
                    element.textContent = `RM${item.toFixed(2)}`;
                } else {
                    const cname = formatCoinValue(item);
                    element.className = `coin ${cname}`;
                    element.textContent = formatCoinName(cname);
                }

                problemWallet.appendChild(element);
            });
        }

        // Generate multiple choice options for money problems
        function generateProblemOptions() {
            problemOptions.innerHTML = '';

            const correctOption = `RM${currentProblem.answer.toFixed(2)}`;
            const options = [correctOption];

            // Generate incorrect options
            while (options.length < 4) {
                let wrongValue;

                if (Math.random() > 0.5) {
                    // Add a little
                    wrongValue = currentProblem.answer + (Math.random() * 2 + 0.5);
                } else {
                    // Subtract a little
                    wrongValue = Math.max(0.01, currentProblem.answer - (Math.random() * 2 + 0.5));
                }

                wrongValue = Math.round(wrongValue * 100) / 100;
                const option = `RM${wrongValue.toFixed(2)}`;

                if (option !== correctOption && !options.includes(option)) {
                    options.push(option);
                }
            }

            // Shuffle options
            shuffleArray(options);

            // Create option buttons
            options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.addEventListener('click', () => {
                    problemInput.value = option.replace('RM', '');

                    // Highlight selected option
                    document.querySelectorAll('#problemOptions .option-btn').forEach(b => {
                        b.classList.remove('selected');
                    });
                    btn.classList.add('selected');
                });
                problemOptions.appendChild(btn);
            });
        }

        // Check counting answer
        function checkCounting() {
            const userAnswer = parseFloat(countingInput.value) || 0;

            // Check if answer is correct (with tolerance for floating point)
            const isCorrect = Math.abs(userAnswer - currentProblem.total) < 0.01;

            // Provide feedback
            if (isCorrect) {
                countingFeedback.textContent = `Betul! Jumlahnya ialah RM${currentProblem.total.toFixed(2)}.`;
                countingFeedback.className = 'feedback correct';
                updateScore(10);
                addToMoneyBag(1);
            } else {
                countingFeedback.textContent = `Belum betul. Jumlah yang betul ialah RM${currentProblem.total.toFixed(2)}. Cuba lagi!`;
                countingFeedback.className = 'feedback incorrect';
                resetStreak();
            }

            // Generate new problem after a short delay
            setTimeout(() => {
                if (isCorrect) {
                    generateCountingProblem();
                    clearInputs();
                }
            }, 1200);
        }

        // Check change answer
        function checkChange() {
            // Check if an option is selected
            if (!selectedCoins || selectedCoins.length === 0) {
                changeFeedback.textContent = 'Sila pilih baki yang patut anda terima!';
                changeFeedback.className = 'feedback incorrect';
                return;
            }

            // Calculate total of selected coins
            const selectedTotal = selectedCoins.reduce((sum, coin) => sum + coin, 0);

            // Check if answer is correct (with tolerance for floating point)
            const isCorrect = Math.abs(selectedTotal - currentProblem.change) < 0.01;

            // Provide feedback
            if (isCorrect) {
                changeFeedback.textContent = `Betul! Baki anda sepatutnya RM${currentProblem.change.toFixed(2)}.`;
                changeFeedback.className = 'feedback correct';
                updateScore(15);
                addToMoneyBag(2);
            } else {
                changeFeedback.textContent = `Belum betul. Baki yang betul ialah RM${currentProblem.change.toFixed(2)}. Cuba lagi!`;
                changeFeedback.className = 'feedback incorrect';
                resetStreak();
            }

            // Generate new problem after a short delay
            setTimeout(() => {
                if (isCorrect) {
                    generateChangeProblem();
                    clearInputs();
                }
            }, 1200);
        }

        // Check money problem answer
        function checkProblem() {
            const userAnswer = parseFloat(problemInput.value) || 0;

            // Check if answer is correct (with tolerance for floating point)
            const isCorrect = Math.abs(userAnswer - currentProblem.answer) < 0.01;

            // Provide feedback
            if (isCorrect) {
                problemFeedback.textContent = `Betul! Jawapannya ialah RM${currentProblem.answer.toFixed(2)}.`;
                problemFeedback.className = 'feedback correct';
                updateScore(15);
                addToMoneyBag(2);
            } else {
                problemFeedback.textContent = `Belum betul. Jawapan yang betul ialah RM${currentProblem.answer.toFixed(2)}. Cuba lagi!`;
                problemFeedback.className = 'feedback incorrect';
                resetStreak();
            }

            // Generate new problem after a short delay
            setTimeout(() => {
                if (isCorrect) {
                    generateMoneyProblem();
                    clearInputs();
                }
            }, 1200);
        }

        // Helper function to format coin name
        function formatCoinName(coin) {
            switch(coin) {
                case 'coin-5sen': return '5s';
                case 'coin-10sen': return '10s';
                case 'coin-20sen': return '20s';
                case 'coin-50sen': return '50s';
                default: return String(coin);
            }
        }

        // Helper function to format coin value -> returns coin name for CSS/class usage
        function formatCoinValue(value) {
            if (Math.abs(value - 0.05) < 0.0001) return 'coin-5sen';
            if (Math.abs(value - 0.10) < 0.0001) return 'coin-10sen';
            if (Math.abs(value - 0.20) < 0.0001) return 'coin-20sen';
            if (Math.abs(value - 0.50) < 0.0001) return 'coin-50sen';
            return value;
        }

        // Helper function to make change for a given amount
        function makeChange(amount) {
            let remaining = Math.max(0, Math.round(amount * 100) / 100);
            const change = [];

            // Available coins/bills in descending order (Malaysian currency)
            const denominations = [10, 5, 1, 0.50, 0.20, 0.10, 0.05];

            denominations.forEach(denom => {
                const count = Math.floor(remaining / denom);
                for (let i = 0; i < count; i++) {
                    change.push(denom);
                    remaining = Math.round((remaining - denom) * 100) / 100;
                }
            });

            return change;
        }

        // Helper function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Score and money management
        function updateScore(points) {
            score += points;
            scoreElement.textContent = score;

            // Level up every 100 points
            const newLevel = Math.floor(score / 100) + 1;
            if (newLevel > level) {
                level = newLevel;
                levelElement.textContent = level;

                // Show level up message
                const feedback = document.querySelector(`#${currentGame}Game .feedback`);
                feedback.textContent += ` Tahap meningkat! Anda kini di tahap ${level}!`;
            }
        }

        function addToMoneyBag(amount) {
            moneyBag += amount;
            // show with two decimals
            moneyBagElement.textContent = moneyBag.toFixed(2);
        }

        function resetStreak() {
            // For this game, we don't have a streak counter
        }

        // Initialize the game when the page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>