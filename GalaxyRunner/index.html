<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Galaxy Runner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(180deg, #000428 0%, #004e92 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            border: 3px solid #00f3ff;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
        }
        
        h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, #00f3ff, #ff00ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0e7ff;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .game-container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }
        
        .game-screen {
            flex: 2;
            min-width: 300px;
            height: 500px;
            background: rgba(0, 10, 30, 0.8);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 3px solid #00f3ff;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.5);
        }
        
        .game-info {
            flex: 1;
            min-width: 250px;
            background: rgba(0, 10, 30, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 3px solid #ff00ff;
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: #00f3ff;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(0, 243, 255, 0.3);
        }
        
        /* Game elements */
        .ship {
            position: absolute;
            width: 60px;
            height: 60px;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: radial-gradient(circle, #00f3ff 0%, #004e92 70%);
            border-radius: 50% 50% 30% 30%;
            box-shadow: 0 0 20px #00f3ff;
            z-index: 10;
            transition: left 0.1s ease;
        }
        
        .ship::before {
            content: '';
            position: absolute;
            width: 30px;
            height: 40px;
            background: linear-gradient(90deg, #ff9900, #ff3300);
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50% 50% 0 0;
            box-shadow: 0 0 10px #ff3300;
        }
        
        .crystal {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #ff00ff 0%, #9900cc 100%);
            border-radius: 50%;
            box-shadow: 0 0 15px #ff00ff;
            z-index: 5;
        }
        
        .asteroid {
            position: absolute;
            background: radial-gradient(circle, #888888 0%, #333333 100%);
            border-radius: 50%;
            box-shadow: 0 0 10px #666666;
            z-index: 5;
        }
        
        .math-problem {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px solid #ff9900;
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.7);
            text-align: center;
            min-width: 250px;
            z-index: 20;
        }
        
        .problem-text {
            font-size: 1.2rem;
            color: #ff9900;
            margin-bottom: 10px;
        }
        
        .problem-equation {
            font-size: 2rem;
            color: white;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .control-btn {
            padding: 12px 25px;
            font-size: 1.3rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background: linear-gradient(90deg, #004e92, #00f3ff);
            color: white;
            transition: all 0.2s ease;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }
        
        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4);
        }
        
        .control-btn:active {
            transform: translateY(1px);
        }
        
        .control-btn.correct {
            background: linear-gradient(90deg, #00cc66, #00ff99);
        }
        
        .control-btn.wrong {
            background: linear-gradient(90deg, #cc0033, #ff3366);
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .stat-box {
            background: rgba(0, 20, 50, 0.6);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(0, 243, 255, 0.3);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #00f3ff;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #a0e7ff;
            margin-top: 5px;
        }
        
        .energy-bar-container {
            margin-top: 10px;
        }
        
        .energy-bar {
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
            border: 1px solid rgba(0, 243, 255, 0.5);
        }
        
        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff00ff, #00f3ff);
            width: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .upgrades {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .upgrade-item {
            background: rgba(0, 20, 50, 0.6);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 153, 0, 0.3);
        }
        
        .upgrade-name {
            font-weight: bold;
            color: #ff9900;
        }
        
        .upgrade-cost {
            color: #ff00ff;
            font-weight: bold;
        }
        
        .upgrade-btn {
            padding: 8px 15px;
            background: linear-gradient(90deg, #ff9900, #ff3300);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .upgrade-btn:disabled {
            background: #666666;
            cursor: not-allowed;
        }
        
        .upgrade-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }
        
        .instructions {
            background: rgba(0, 10, 30, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 3px solid #ff9900;
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.5);
        }
        
        .instructions ul {
            padding-left: 20px;
            margin-top: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            color: #a0e7ff;
        }
        
        .game-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            z-index: 100;
            border: 3px solid #00f3ff;
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.8);
            display: none;
            max-width: 500px;
            width: 90%;
        }
        
        .message-title {
            font-size: 2.5rem;
            color: #ff00ff;
            margin-bottom: 20px;
        }
        
        .message-text {
            font-size: 1.3rem;
            margin-bottom: 30px;
            color: #a0e7ff;
            line-height: 1.5;
        }
        
        .message-btn {
            padding: 15px 40px;
            font-size: 1.3rem;
            background: linear-gradient(90deg, #004e92, #00f3ff);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
        }
        
        .star.small {
            width: 1px;
            height: 1px;
        }
        
        .star.medium {
            width: 2px;
            height: 2px;
        }
        
        .star.large {
            width: 3px;
            height: 3px;
            background: #a0e7ff;
        }
        
        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
            }
            
            .game-screen {
                height: 400px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .instructions ul {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .game-screen {
                height: 350px;
            }
            
            .problem-equation {
                font-size: 1.5rem;
            }
            
            .control-btn {
                padding: 10px 15px;
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Math Galaxy Runner</h1>
            <p class="subtitle">Pilot your ship, collect energy crystals, and solve math problems to upgrade your spacecraft!</p>
        </header>
        
        <div class="game-container">
            <div class="game-screen" id="gameScreen">
                <div class="stars" id="stars"></div>
                <div class="math-problem" id="mathProblem">
                    <div class="problem-text" id="problemText">Solve to collect energy!</div>
                    <div class="problem-equation" id="problemEquation">5 + 3 = ?</div>
                    <div class="controls" id="problemControls">
                        <!-- Answer buttons will be added here -->
                    </div>
                </div>
                <div class="ship" id="ship"></div>
                <!-- Crystals and asteroids will be added here dynamically -->
            </div>
            
            <div class="game-info">
                <div>
                    <h2 class="section-title">Ship Status</h2>
                    <div class="stats">
                        <div class="stat-box">
                            <div class="stat-value" id="energyValue">100</div>
                            <div class="stat-label">Energy</div>
                            <div class="energy-bar-container">
                                <div class="energy-bar">
                                    <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="scoreValue">0</div>
                            <div class="stat-label">Score</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="speedValue">1</div>
                            <div class="stat-label">Speed Level</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="crystalsValue">0</div>
                            <div class="stat-label">Crystals</div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h2 class="section-title">Ship Upgrades</h2>
                    <div class="upgrades">
                        <div class="upgrade-item">
                            <div>
                                <div class="upgrade-name">Engine Boost</div>
                                <div class="upgrade-cost" id="engineCost">Cost: 5 crystals</div>
                            </div>
                            <button class="upgrade-btn" id="engineBtn" onclick="buyUpgrade('engine')">Buy</button>
                        </div>
                        <div class="upgrade-item">
                            <div>
                                <div class="upgrade-name">Energy Capacity</div>
                                <div class="upgrade-cost" id="capacityCost">Cost: 10 crystals</div>
                            </div>
                            <button class="upgrade-btn" id="capacityBtn" onclick="buyUpgrade('capacity')">Buy</button>
                        </div>
                        <div class="upgrade-item">
                            <div>
                                <div class="upgrade-name">Shield Generator</div>
                                <div class="upgrade-cost" id="shieldCost">Cost: 15 crystals</div>
                            </div>
                            <button class="upgrade-btn" id="shieldBtn" onclick="buyUpgrade('shield')">Buy</button>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h2 class="section-title">Controls</h2>
                    <p style="color: #a0e7ff; margin-bottom: 10px;">Use LEFT and RIGHT arrow keys to move your ship</p>
                    <p style="color: #a0e7ff;">Click on math answers to solve problems</p>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h2 class="section-title">How to Play</h2>
            <ul>
                <li>Move your ship with arrow keys to collect purple energy crystals</li>
                <li>Avoid gray asteroids - they drain your energy</li>
                <li>Solve math problems to recharge your ship's energy</li>
                <li>Use collected crystals to buy ship upgrades</li>
                <li>Keep your energy above 0 to stay alive</li>
                <li>Game gets faster as your score increases!</li>
            </ul>
        </div>
    </div>
    
    <div class="game-message" id="gameMessage">
        <div class="message-title" id="messageTitle">Game Over</div>
        <div class="message-text" id="messageText">Your ship ran out of energy!</div>
        <button class="message-btn" id="messageBtn">Play Again</button>
    </div>

    <script>
        // Game state
        const gameState = {
            score: 0,
            energy: 100,
            maxEnergy: 100,
            crystals: 0,
            speedLevel: 1,
            gameRunning: true,
            shipPosition: 50, // percentage from left
            lastTime: 0,
            gameObjects: [],
            upgrades: {
                engine: { level: 1, cost: 5 },
                capacity: { level: 1, cost: 10 },
                shield: { level: 0, cost: 15 }
            },
            currentProblem: null
        };
        
        // DOM elements
        const gameScreen = document.getElementById('gameScreen');
        const ship = document.getElementById('ship');
        const mathProblem = document.getElementById('mathProblem');
        const problemText = document.getElementById('problemText');
        const problemEquation = document.getElementById('problemEquation');
        const problemControls = document.getElementById('problemControls');
        const energyValue = document.getElementById('energyValue');
        const energyFill = document.getElementById('energyFill');
        const scoreValue = document.getElementById('scoreValue');
        const speedValue = document.getElementById('speedValue');
        const crystalsValue = document.getElementById('crystalsValue');
        const engineBtn = document.getElementById('engineBtn');
        const capacityBtn = document.getElementById('capacityBtn');
        const shieldBtn = document.getElementById('shieldBtn');
        const engineCost = document.getElementById('engineCost');
        const capacityCost = document.getElementById('capacityCost');
        const shieldCost = document.getElementById('shieldCost');
        const gameMessage = document.getElementById('gameMessage');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const messageBtn = document.getElementById('messageBtn');
        const starsContainer = document.getElementById('stars');
        
        // Create background stars
        function createStars() {
            starsContainer.innerHTML = '';
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                const size = Math.random() > 0.8 ? 'large' : (Math.random() > 0.5 ? 'medium' : 'small');
                star.className = `star ${size}`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                starsContainer.appendChild(star);
            }
        }
        
        // Initialize game
        function initGame() {
            createStars();
            updateUI();
            
            // Set up event listeners
            document.addEventListener('keydown', handleKeyPress);
            messageBtn.addEventListener('click', resetGame);
            
            // Start game loop
            requestAnimationFrame(gameLoop);
            
            // Start generating game objects
            setInterval(generateGameObject, 1000);
            
            // Generate first math problem
            generateMathProblem();
            
            // Start energy drain
            setInterval(drainEnergy, 1000);
        }
        
        // Game loop
        function gameLoop(timestamp) {
            if (!gameState.gameRunning) return;
            
            // Calculate delta time
            const deltaTime = timestamp - (gameState.lastTime || timestamp);
            gameState.lastTime = timestamp;
            
            // Update game objects
            updateGameObjects(deltaTime);
            
            // Check collisions
            checkCollisions();
            
            // Update ship position
            updateShipPosition();
            
            // Continue game loop
            requestAnimationFrame(gameLoop);
        }
        
        // Handle keyboard input
        function handleKeyPress(e) {
            if (!gameState.gameRunning) return;
            
            const moveAmount = 5;
            
            if (e.key === 'ArrowLeft' || e.key === 'a') {
                gameState.shipPosition = Math.max(5, gameState.shipPosition - moveAmount);
            } else if (e.key === 'ArrowRight' || e.key === 'd') {
                gameState.shipPosition = Math.min(95, gameState.shipPosition + moveAmount);
            }
        }
        
        // Update ship position on screen
        function updateShipPosition() {
            ship.style.left = `${gameState.shipPosition}%`;
        }
        
        // Generate game objects (crystals and asteroids)
        function generateGameObject() {
            if (!gameState.gameRunning) return;
            
            const screenWidth = gameScreen.clientWidth;
            const screenHeight = gameScreen.clientHeight;
            
            // Decide what to generate (70% crystal, 30% asteroid)
            const isCrystal = Math.random() > 0.3;
            
            if (isCrystal) {
                // Create crystal
                const crystal = document.createElement('div');
                crystal.className = 'crystal';
                crystal.style.left = `${Math.random() * (screenWidth - 30)}px`;
                crystal.style.top = '-30px';
                crystal.dataset.type = 'crystal';
                gameScreen.appendChild(crystal);
                gameState.gameObjects.push({
                    element: crystal,
                    type: 'crystal',
                    speed: 2 + gameState.speedLevel * 0.5,
                    x: parseInt(crystal.style.left),
                    y: -30
                });
            } else {
                // Create asteroid
                const size = 20 + Math.random() * 30;
                const asteroid = document.createElement('div');
                asteroid.className = 'asteroid';
                asteroid.style.width = `${size}px`;
                asteroid.style.height = `${size}px`;
                asteroid.style.left = `${Math.random() * (screenWidth - size)}px`;
                asteroid.style.top = `-${size}px`;
                asteroid.dataset.type = 'asteroid';
                gameScreen.appendChild(asteroid);
                gameState.gameObjects.push({
                    element: asteroid,
                    type: 'asteroid',
                    speed: 1.5 + gameState.speedLevel * 0.3,
                    x: parseInt(asteroid.style.left),
                    y: -size,
                    size: size
                });
            }
        }
        
        // Update all game objects
        function updateGameObjects(deltaTime) {
            const screenHeight = gameScreen.clientHeight;
            
            for (let i = gameState.gameObjects.length - 1; i >= 0; i--) {
                const obj = gameState.gameObjects[i];
                
                // Move object down
                obj.y += obj.speed;
                obj.element.style.top = `${obj.y}px`;
                
                // Remove if off screen
                if (obj.y > screenHeight) {
                    obj.element.remove();
                    gameState.gameObjects.splice(i, 1);
                } else {
                    // Update position in array
                    obj.x = parseInt(obj.element.style.left);
                }
            }
        }
        
        // Check for collisions
        function checkCollisions() {
            if (!gameState.gameRunning) return;
            
            const shipRect = ship.getBoundingClientRect();
            const screenRect = gameScreen.getBoundingClientRect();
            
            for (let i = gameState.gameObjects.length - 1; i >= 0; i--) {
                const obj = gameState.gameObjects[i];
                const objRect = obj.element.getBoundingClientRect();
                
                // Check collision with ship
                if (rectsOverlap(shipRect, objRect)) {
                    if (obj.type === 'crystal') {
                        // Collect crystal
                        gameState.crystals++;
                        playSoundEffect('collect');
                    } else if (obj.type === 'asteroid') {
                        // Hit asteroid
                        gameState.energy -= 10 + (gameState.upgrades.shield.level * 5);
                        playSoundEffect('hit');
                    }
                    
                    // Remove object
                    obj.element.remove();
                    gameState.gameObjects.splice(i, 1);
                    
                    // Update UI
                    updateUI();
                    
                    // Check if game over
                    if (gameState.energy <= 0) {
                        gameState.energy = 0;
                        gameOver();
                    }
                }
            }
        }
        
        // Check if two rectangles overlap
        function rectsOverlap(rect1, rect2) {
            return !(rect1.right < rect2.left || 
                     rect1.left > rect2.right || 
                     rect1.bottom < rect2.top || 
                     rect1.top > rect2.bottom);
        }
        
        // Generate a math problem
        function generateMathProblem() {
            if (!gameState.gameRunning) return;
            
            // Show math problem randomly (30% chance every 5 seconds)
            if (Math.random() > 0.7) {
                const problem = createMathProblem();
                gameState.currentProblem = problem;
                
                problemText.textContent = problem.text;
                problemEquation.textContent = problem.equation;
                
                // Clear previous buttons
                problemControls.innerHTML = '';
                
                // Create answer buttons
                problem.answers.forEach(answer => {
                    const button = document.createElement('button');
                    button.className = 'control-btn';
                    button.textContent = answer;
                    button.addEventListener('click', () => checkMathAnswer(answer, problem.correctAnswer));
                    problemControls.appendChild(button);
                });
                
                // Show problem
                mathProblem.style.display = 'block';
                
                // Hide problem after 10 seconds
                setTimeout(() => {
                    if (mathProblem.style.display !== 'none') {
                        mathProblem.style.display = 'none';
                    }
                }, 10000);
            }
            
            // Schedule next problem
            setTimeout(generateMathProblem, 5000);
        }
        
        // Create a math problem
        function createMathProblem() {
            const types = ['addition', 'subtraction', 'multiplication', 'division'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let num1, num2, answer, equation, text;
            
            // Make problems easier at lower speeds
            const maxNumber = 10 + gameState.speedLevel * 5;
            
            switch(type) {
                case 'addition':
                    num1 = Math.floor(Math.random() * maxNumber) + 1;
                    num2 = Math.floor(Math.random() * maxNumber) + 1;
                    answer = num1 + num2;
                    equation = `${num1} + ${num2} = ?`;
                    text = "Solve this addition problem:";
                    break;
                case 'subtraction':
                    num1 = Math.floor(Math.random() * maxNumber) + 5;
                    num2 = Math.floor(Math.random() * (num1 - 1)) + 1;
                    answer = num1 - num2;
                    equation = `${num1} - ${num2} = ?`;
                    text = "Solve this subtraction problem:";
                    break;
                case 'multiplication':
                    num1 = Math.floor(Math.random() * Math.min(8, maxNumber/2)) + 1;
                    num2 = Math.floor(Math.random() * Math.min(8, maxNumber/2)) + 1;
                    answer = num1 * num2;
                    equation = `${num1} ร ${num2} = ?`;
                    text = "Solve this multiplication problem:";
                    break;
                case 'division':
                    answer = Math.floor(Math.random() * Math.min(8, maxNumber/2)) + 1;
                    num2 = Math.floor(Math.random() * Math.min(8, maxNumber/2)) + 1;
                    num1 = answer * num2;
                    equation = `${num1} รท ${num2} = ?`;
                    text = "Solve this division problem:";
                    break;
            }
            
            // Generate wrong answers
            const answers = generateMathAnswers(answer);
            
            return {
                type: type,
                text: text,
                equation: equation,
                correctAnswer: answer,
                answers: answers
            };
        }
        
        // Generate answer options for math problem
        function generateMathAnswers(correctAnswer) {
            const answers = [correctAnswer];
            
            // Add 3 wrong answers
            for (let i = 0; i < 3; i++) {
                let wrongAnswer;
                const offset = Math.floor(Math.random() * 5) + 1;
                
                if (Math.random() > 0.5) {
                    wrongAnswer = correctAnswer + offset;
                } else {
                    wrongAnswer = correctAnswer - offset;
                }
                
                // Make sure it's positive and different
                if (wrongAnswer < 0) wrongAnswer = Math.abs(wrongAnswer) + 1;
                if (wrongAnswer === correctAnswer || answers.includes(wrongAnswer)) {
                    wrongAnswer += 3;
                }
                
                answers.push(wrongAnswer);
            }
            
            // Shuffle answers
            return shuffleArray(answers);
        }
        
        // Check math answer
        function checkMathAnswer(selectedAnswer, correctAnswer) {
            const buttons = problemControls.querySelectorAll('.control-btn');
            
            // Disable all buttons
            buttons.forEach(btn => {
                btn.disabled = true;
                
                // Mark correct and wrong answers
                if (parseInt(btn.textContent) === correctAnswer) {
                    btn.classList.add('correct');
                } else if (parseInt(btn.textContent) === selectedAnswer) {
                    btn.classList.add('wrong');
                }
            });
            
            if (parseInt(selectedAnswer) === correctAnswer) {
                // Correct answer - add energy
                gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + 30);
                gameState.score += 50;
                playSoundEffect('correct');
                
                // Hide problem after delay
                setTimeout(() => {
                    mathProblem.style.display = 'none';
                }, 1000);
            } else {
                // Wrong answer - small penalty
                gameState.energy = Math.max(0, gameState.energy - 10);
                playSoundEffect('wrong');
                
                // Hide problem after delay
                setTimeout(() => {
                    mathProblem.style.display = 'none';
                }, 1500);
            }
            
            updateUI();
            
            // Check if game over
            if (gameState.energy <= 0) {
                gameState.energy = 0;
                gameOver();
            }
        }
        
        // Drain energy over time
        function drainEnergy() {
            if (!gameState.gameRunning) return;
            
            // Energy drains faster at higher speeds
            const drainRate = 0.5 + gameState.speedLevel * 0.2;
            gameState.energy = Math.max(0, gameState.energy - drainRate);
            
            // Increase speed with score
            gameState.speedLevel = Math.min(5, 1 + Math.floor(gameState.score / 500));
            
            updateUI();
            
            // Check if game over
            if (gameState.energy <= 0) {
                gameState.energy = 0;
                gameOver();
            }
        }
        
        // Buy upgrade
        function buyUpgrade(type) {
            const upgrade = gameState.upgrades[type];
            
            if (gameState.crystals >= upgrade.cost) {
                gameState.crystals -= upgrade.cost;
                
                // Apply upgrade
                if (type === 'engine') {
                    upgrade.level++;
                    upgrade.cost = Math.floor(upgrade.cost * 1.5);
                } else if (type === 'capacity') {
                    upgrade.level++;
                    gameState.maxEnergy = 100 + (upgrade.level * 20);
                    gameState.energy = gameState.maxEnergy;
                    upgrade.cost = Math.floor(upgrade.cost * 1.8);
                } else if (type === 'shield') {
                    upgrade.level = 1;
                    upgrade.cost = Math.floor(upgrade.cost * 2);
                }
                
                playSoundEffect('upgrade');
                updateUI();
            }
        }
        
        // Update UI
        function updateUI() {
            energyValue.textContent = Math.floor(gameState.energy);
            energyFill.style.width = `${(gameState.energy / gameState.maxEnergy) * 100}%`;
            scoreValue.textContent = gameState.score;
            speedValue.textContent = gameState.speedLevel;
            crystalsValue.textContent = gameState.crystals;
            
            // Update upgrade buttons
            engineCost.textContent = `Cost: ${gameState.upgrades.engine.cost} crystals`;
            capacityCost.textContent = `Cost: ${gameState.upgrades.capacity.cost} crystals`;
            shieldCost.textContent = `Cost: ${gameState.upgrades.shield.cost} crystals`;
            
            engineBtn.disabled = gameState.crystals < gameState.upgrades.engine.cost;
            capacityBtn.disabled = gameState.crystals < gameState.upgrades.capacity.cost;
            shieldBtn.disabled = gameState.crystals < gameState.upgrades.shield.cost || gameState.upgrades.shield.level > 0;
            
            // Update ship appearance based on upgrades
            if (gameState.upgrades.shield.level > 0) {
                ship.style.boxShadow = '0 0 20px #00f3ff, 0 0 30px #ff00ff';
            }
        }
        
        // Game over
        function gameOver() {
            gameState.gameRunning = false;
            
            // Show game over message
            messageTitle.textContent = "Game Over";
            messageText.textContent = `Your ship ran out of energy! Final Score: ${gameState.score}`;
            gameMessage.style.display = 'block';
        }
        
        // Reset game
        function resetGame() {
            // Reset game state
            gameState.score = 0;
            gameState.energy = 100;
            gameState.maxEnergy = 100;
            gameState.crystals = 0;
            gameState.speedLevel = 1;
            gameState.gameRunning = true;
            gameState.shipPosition = 50;
            gameState.gameObjects = [];
            gameState.upgrades = {
                engine: { level: 1, cost: 5 },
                capacity: { level: 1, cost: 10 },
                shield: { level: 0, cost: 15 }
            };
            
            // Clear game objects
            document.querySelectorAll('.crystal, .asteroid').forEach(el => el.remove());
            
            // Hide message and problem
            gameMessage.style.display = 'none';
            mathProblem.style.display = 'none';
            
            // Update UI
            updateUI();
            updateShipPosition();
            
            // Restart game loop
            requestAnimationFrame(gameLoop);
        }
        
        // Play sound effect (simulated)
        function playSoundEffect(type) {
            // In a real game, you would play actual audio files
            // For this demo, we'll just log or change visuals
            console.log(`Playing sound: ${type}`);
        }
        
        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Initialize game when page loads
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>