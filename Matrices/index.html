<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pastel Matrix Garden</title>
    <style>
        /* --- Pastel Color Palette --- */
        :root {
            --bg: #fdf6f0;
            --mint: #b8e4c9;
            --lavender: #d5d1f1;
            --peach: #ffcfdf;
            --sky: #a3d8f4;
            --text: #5a5a5a;
            --white: #ffffff;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        /* --- Soft UI / Claymorphism --- */
        .container {
            width: 90%;
            max-width: 600px;
            background: var(--white);
            border-radius: 40px;
            padding: 40px;
            box-shadow: 20px 20px 60px #d9d9d9, -20px -20px 60px #ffffff;
            text-align: center;
        }

        h1 {
            color: #88a;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .hud {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .status-pill {
            background: var(--bg);
            padding: 8px 20px;
            border-radius: 20px;
            box-shadow: inset 4px 4px 8px #d1d1d1, inset -4px -4px 8px #ffffff;
        }

        /* --- Slower Timer Bar --- */
        .timer-container {
            width: 100%;
            height: 20px;
            background: var(--bg);
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: inset 4px 4px 8px #d1d1d1;
            overflow: hidden;
        }
        .timer-bar {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, var(--mint), var(--sky));
            border-radius: 10px;
            transition: width 0.3s ease; /* Smoother visual transition */
        }

        /* --- Matrix Styling --- */
        .problem-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 40px 0;
            min-height: 150px;
        }

        .matrix {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding: 15px;
            background: var(--white);
            border: 4px solid var(--lavender);
            border-radius: 20px;
            box-shadow: 8px 8px 15px #e0e0e0;
        }

        .matrix span, .matrix input {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text);
        }

        input {
            background: var(--bg);
            border: none;
            border-radius: 10px;
            text-align: center;
            box-shadow: inset 2px 2px 5px #ccc;
            outline: none;
            width: 45px;
        }
        input:focus { background: var(--lavender); }

        .operator { font-size: 1.8rem; font-weight: bold; color: #aaa; }

        /* --- Buttons --- */
        button {
            padding: 15px 35px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 25px;
            border: none;
            background: var(--sky);
            color: white;
            box-shadow: 5px 5px 15px #c0d8e4;
            transition: 0.2s;
        }
        button:hover { transform: translateY(-2px); box-shadow: 5px 8px 20px #c0d8e4; }
        button:active { transform: translateY(0); }

        /* --- Screen States --- */
        .screen { display: none; }
        .active { display: block; }

        .stars { font-size: 3rem; margin: 20px 0; color: #ffdfba; }
        .empty-star { color: #eee; }

        @keyframes correct-pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .correct { animation: correct-pop 0.4s ease; }
    </style>
</head>
<body>

    <div class="container" id="main-box">
        <div id="start-screen" class="screen active">
            <h1>Matrix Garden</h1>
            <p>A calm way to practice Form 5 Matrices</p>
            <div style="margin: 30px 0; color: #888; font-size: 0.9rem;">
                Levels: Addition ➔ Scalar ➔ Determinant ➔ Multiplication
            </div>
            <button onclick="startGame()">BEGIN LESSON</button>
        </div>

        <div id="game-screen" class="screen">
            <div class="hud">
                <div class="status-pill">Level <span id="level-display">1</span></div>
                <div class="status-pill">Score: <span id="score-display">0</span></div>
            </div>
            
            <div class="timer-container">
                <div id="timer-bar" class="timer-bar"></div>
            </div>

            <p id="instruction" style="color: #999;">Solve the operation below:</p>
            <div id="problem-area" class="problem-container"></div>
            
            <button id="submit-btn" onclick="checkAnswer()">CHECK ANSWER</button>
        </div>

        <div id="end-screen" class="screen">
            <h1>Session Complete</h1>
            <div class="stars" id="star-display"></div>
            <p>Final Score: <strong id="final-score">0</strong></p>
            <p id="feedback-text">Keep practicing, you're doing great!</p>
            <button onclick="startGame()">RESTART</button>
        </div>
    </div>

    <script>
        let state = {
            score: 0, level: 1, timeLeft: 100,
            timerInterval: null, currentAnswers: [], isActive: false
        };

        function startGame() {
            state.score = 0; state.level = 1; state.timeLeft = 100; state.isActive = true;
            showScreen('game-screen');
            updateUI();
            newLevel();
            
            if (state.timerInterval) clearInterval(state.timerInterval);
            // TIMER SPEED: Reduced drain rate to 0.2 for a more relaxed pace
            state.timerInterval = setInterval(() => {
                if(!state.isActive) return;
                state.timeLeft -= 0.22; 
                document.getElementById('timer-bar').style.width = Math.max(0, state.timeLeft) + '%';
                if (state.timeLeft <= 0) endGame();
            }, 100);
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function updateUI() {
            document.getElementById('score-display').innerText = state.score;
            document.getElementById('level-display').innerText = state.level;
        }

        function rInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

        function newLevel() {
            const area = document.getElementById('problem-area');
            area.innerHTML = '';
            const type = ((state.level - 1) % 4) + 1;
            
            if (type === 1) { // Add/Sub
                let m1 = [rInt(1,5), rInt(1,5), rInt(1,5), rInt(1,5)];
                let m2 = [rInt(1,4), rInt(1,4), rInt(1,4), rInt(1,4)];
                let sub = Math.random() > 0.5;
                state.currentAnswers = m1.map((v, i) => sub ? v - m2[i] : v + m2[i]);
                area.append(createMatrix(m1), createOp(sub?'-':'+'), createMatrix(m2), createOp('='), createInputMatrix());
            } 
            else if (type === 2) { // Scalar
                let k = rInt(2, 3);
                let m = [rInt(1, 5), rInt(-2, 3), rInt(0, 4), rInt(1, 4)];
                state.currentAnswers = m.map(v => v * k);
                area.append(createOp(k), createMatrix(m), createOp('='), createInputMatrix());
            }
            else if (type === 3) { // Det
                let a=rInt(1,4), b=rInt(1,3), c=rInt(1,2), d=rInt(1,4);
                state.currentAnswers = [(a*d)-(b*c)];
                area.append(createOp('|A| of'), createMatrix([a,b,c,d]), createOp('='), createSingleInput());
            }
            else { // Mult
                let m1 = [rInt(1,2), rInt(1,2), rInt(0,1), rInt(1,2)];
                let m2 = [rInt(1,2), rInt(0,1), rInt(1,2), rInt(1,2)];
                state.currentAnswers = [
                    (m1[0]*m2[0])+(m1[1]*m2[2]), (m1[0]*m2[1])+(m1[1]*m2[3]),
                    (m1[2]*m2[0])+(m1[3]*m2[2]), (m1[2]*m2[1])+(m1[3]*m2[3])
                ];
                area.append(createMatrix(m1), createOp('×'), createMatrix(m2), createOp('='), createInputMatrix());
            }
        }

        function createMatrix(vals) {
            let d = document.createElement('div'); d.className = 'matrix';
            vals.forEach(v => { let s = document.createElement('span'); s.innerText = v; d.appendChild(s); });
            return d;
        }

        function createInputMatrix() {
            let d = document.createElement('div'); d.className = 'matrix';
            for(let i=0; i<4; i++) {
                let inp = document.createElement('input');
                inp.type = "number";
                d.appendChild(inp);
            }
            return d;
        }

        function createSingleInput() {
            let i = document.createElement('input'); i.type = "number"; i.style.width = "70px"; return i;
        }

        function createOp(txt) {
            let d = document.createElement('div'); d.className = 'operator'; d.innerText = txt; return d;
        }

        function checkAnswer() {
            let inputs = document.querySelectorAll('#problem-area input');
            let userVals = Array.from(inputs).map(i => parseInt(i.value));
            let isCorrect = userVals.length === state.currentAnswers.length && 
                            userVals.every((v, i) => v === state.currentAnswers[i]);

            if (isCorrect) {
                state.score += 150;
                state.timeLeft = Math.min(100, state.timeLeft + 25); // Generous time bonus
                state.level++;
                updateUI();
                
                document.getElementById('main-box').classList.add('correct');
                setTimeout(() => {
                    document.getElementById('main-box').classList.remove('correct');
                    newLevel();
                }, 400);
            } else {
                state.timeLeft -= 10;
                // Soft shake
                document.getElementById('main-box').style.backgroundColor = "#ffecec";
                setTimeout(() => document.getElementById('main-box').style.backgroundColor = "white", 300);
            }
        }

        function endGame() {
            state.isActive = false;
            clearInterval(state.timerInterval);
            showScreen('end-screen');
            document.getElementById('final-score').innerText = state.score;
            
            let stars = state.score >= 2000 ? 3 : state.score >= 1000 ? 2 : state.score >= 450 ? 1 : 0;
            let starDiv = document.getElementById('star-display');
            starDiv.innerHTML = '★'.repeat(stars) + '<span class="empty-star">★</span>'.repeat(3 - stars);
            
            const feedback = [
                "Good try! Let's practice more.",
                "Nice work! You're getting the hang of it!",
                "Great job! You're a Matrix pro.",
                "Perfect! You've mastered the Garden!"
            ];
            document.getElementById('feedback-text').innerText = feedback[stars];
        }

        window.addEventListener('keydown', (e) => { if(e.key === 'Enter' && state.isActive) checkAnswer(); });
    </script>
</body>
</html>