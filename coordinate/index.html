<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Math Adventure: Location Explorer</title>
    <style>
        /* Reset and Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', 'Chalkboard SE', cursive;
        }
        
        body {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: #2d3436;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 25px;
            margin: 15px 0;
        }
        
        h1 {
            color: #d63031;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.8rem;
            text-shadow: 2px 2px 0 #ffeaa7;
        }
        
        .subtitle {
            text-align: center;
            color: #0984e3;
            margin-bottom: 25px;
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        /* Instructions Panel */
        .instructions-panel {
            background: #ffeaa7;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid #fdcb6e;
        }
        
        .instructions-title {
            color: #d63031;
            font-size: 1.4rem;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .instructions-text {
            font-size: 1.1rem;
            color: #2d3436;
            line-height: 1.5;
        }
        
        .coordinate-example {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            background: white;
            padding: 10px;
            border-radius: 10px;
            border: 2px dashed #0984e3;
        }
        
        .coordinate-box {
            width: 40px;
            height: 40px;
            background: #74b9ff;
            border: 2px solid #0984e3;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        /* Level Indicator */
        .level-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .level-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #dfe6e9;
            border: 2px solid #636e72;
        }
        
        .level-dot.active {
            background: #00b894;
            border-color: #00a085;
        }
        
        .level-dot.completed {
            background: #74b9ff;
            border-color: #0984e3;
        }
        
        /* Score Container */
        .score-container {
            display: flex;
            justify-content: space-between;
            background: #ffeaa7;
            padding: 15px 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid #fdcb6e;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .score-item {
            color: #d63031;
        }
        
        /* Progress Container */
        .progress-container {
            background: #dfe6e9;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .progress-text {
            font-size: 1.1rem;
            color: #2d3436;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #b2bec3;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #00b894;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        /* Game Area */
        .game-area {
            background: #f7f7f7;
            border-radius: 15px;
            padding: 25px;
            min-height: 500px;
            border: 3px solid #74b9ff;
        }
        
        .game-title {
            color: #e17055;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2rem;
            text-shadow: 1px 1px 0 #ffeaa7;
        }
        
        /* Mission Control */
        .mission-control {
            background: #ffeaa7;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px dashed #fdcb6e;
            text-align: center;
        }
        
        .mission-text {
            font-size: 1.4rem;
            color: #d63031;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .mission-objective {
            font-size: 1.2rem;
            color: #2d3436;
        }
        
        /* Map Container */
        .map-container {
            position: relative;
            width: 100%;
            max-width: 550px;
            height: 400px;
            background: #dfe6e9;
            border: 4px solid #2d3436;
            border-radius: 10px;
            margin: 0 auto 20px;
            overflow: hidden;
        }
        
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(to right, #b2bec3 1px, transparent 1px),
                linear-gradient(to bottom, #b2bec3 1px, transparent 1px);
            background-size: 50px 35px;
        }
        
        /* Grid Coordinates - IMPROVED */
        .grid-coordinates {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .x-coordinates {
            position: absolute;
            bottom: -30px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
        }
        
        .x-label {
            width: 50px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: #d63031;
            background: rgba(255, 255, 255, 0.9);
            padding: 3px;
            border-radius: 5px;
            border: 2px solid #0984e3;
        }
        
        .y-coordinates {
            position: absolute;
            left: -35px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 15px 0;
        }
        
        .y-label {
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: #d63031;
            background: rgba(255, 255, 255, 0.9);
            padding: 3px 8px;
            border-radius: 5px;
            border: 2px solid #0984e3;
        }
        
        /* Grid Cell Labels */
        .cell-label {
            position: absolute;
            font-size: 0.9rem;
            color: rgba(0, 0, 0, 0.3);
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 35px;
        }
        
        /* Highlighted Grid Lines */
        .origin-highlight {
            position: absolute;
            top: 0;
            left: 25px;
            width: 2px;
            height: 100%;
            background: #d63031;
            opacity: 0.3;
        }
        
        .origin-highlight.horizontal {
            top: 17px;
            left: 0;
            width: 100%;
            height: 2px;
        }
        
        /* Location Items */
        .location-item {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            z-index: 10;
            transition: all 0.3s ease;
            border: 2px solid;
            cursor: pointer;
        }
        
        .location-item:hover {
            transform: scale(1.1);
        }
        
        .treasure {
            background: #fdcb6e;
            border-color: #e17055;
            box-shadow: 0 0 10px #fdcb6e;
            animation: bounce 2s infinite;
        }
        
        .landmark {
            background: #74b9ff;
            border-color: #0984e3;
        }
        
        .player {
            background: #00b894;
            border-color: #00a085;
        }
        
        .obstacle {
            background: #b2bec3;
            border-color: #636e72;
        }
        
        .animal {
            background: #a3e4d7;
            border-color: #00b894;
        }
        
        /* Navigation Controls */
        .navigation-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .direction-controls {
            display: grid;
            grid-template-columns: repeat(3, 50px);
            grid-template-rows: repeat(3, 50px);
            gap: 8px;
        }
        
        .dir-btn {
            background: #74b9ff;
            border: 2px solid #0984e3;
            border-radius: 10px;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .dir-btn:hover {
            background: #0984e3;
        }
        
        .dir-btn:nth-child(1) { grid-column: 2; grid-row: 1; } /* Up */
        .dir-btn:nth-child(2) { grid-column: 1; grid-row: 2; } /* Left */
        .dir-btn:nth-child(3) { grid-column: 2; grid-row: 2; background: #0984e3; } /* Center */
        .dir-btn:nth-child(4) { grid-column: 3; grid-row: 2; } /* Right */
        .dir-btn:nth-child(5) { grid-column: 2; grid-row: 3; } /* Down */
        
        /* Input Controls */
        .coordinate-input {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .coord-input {
            width: 60px;
            height: 40px;
            border: 2px solid #74b9ff;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .coord-label {
            font-size: 1.2rem;
            color: #0984e3;
            font-weight: bold;
        }
        
        /* Coordinate Guide */
        .coordinate-guide {
            background: #dfe6e9;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            border: 2px solid #74b9ff;
        }
        
        .guide-title {
            color: #0984e3;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .guide-text {
            color: #2d3436;
            font-size: 1rem;
        }
        
        .guide-example {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: white;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 0 5px;
            border: 1px solid #0984e3;
        }
        
        /* Question Container */
        .question-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .question-text {
            font-size: 1.3rem;
            color: #2d3436;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .options-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .option-btn {
            background: #74b9ff;
            color: white;
            border: 2px solid #0984e3;
            border-radius: 15px;
            padding: 10px 20px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .option-btn:hover {
            background: #0984e3;
            transform: scale(1.05);
        }
        
        .option-btn.correct {
            background: #00b894;
            border-color: #00a085;
        }
        
        .option-btn.wrong {
            background: #e17055;
            border-color: #d63031;
        }
        
        /* Feedback */
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        /* Action Buttons */
        .action-btn {
            background: #e17055;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 0 #d63031;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #d63031;
        }
        
        /* Level Complete Screen */
        .level-complete {
            text-align: center;
            padding: 30px;
        }
        
        .level-complete h2 {
            color: #00b894;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        .level-complete p {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #2d3436;
        }
        
        .level-score {
            background: #ffeaa7;
            padding: 15px;
            border-radius: 15px;
            border: 3px solid #fdcb6e;
            font-size: 1.2rem;
            margin: 20px 0;
        }
        
        /* Game Complete Screen */
        .game-complete {
            text-align: center;
            padding: 40px 20px;
        }
        
        .game-complete h2 {
            color: #d63031;
            font-size: 3rem;
            margin-bottom: 20px;
        }
        
        .game-complete h3 {
            color: #0984e3;
            font-size: 2rem;
            margin-bottom: 30px;
        }
        
        .final-score {
            background: #ffeaa7;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #fdcb6e;
            font-size: 1.5rem;
            margin: 20px 0;
        }
        
        .level-breakdown {
            background: #dfe6e9;
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        /* Animations */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes celebration {
            0% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(5deg); }
            50% { transform: translateY(0) rotate(0deg); }
            75% { transform: translateY(-10px) rotate(-5deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }
        
        .celebration {
            animation: celebration 1s ease-in-out 3;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        
        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .game-area {
                padding: 15px;
                min-height: 400px;
            }
            
            .map-container {
                height: 300px;
            }
            
            .grid-overlay {
                background-size: 40px 30px;
            }
            
            .x-label, .y-label {
                font-size: 1rem;
            }
            
            .options-container {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìç Location Explorer</h1>
        <div class="subtitle">Learn Coordinates While Having Fun!</div>

        <div class="instructions-panel">
            <div class="instructions-title">üéØ How Coordinates Work</div>
            <div class="instructions-text">
                <p>Coordinates are like a secret code to find things on a map! They have two numbers:</p>
                <div class="coordinate-example">
                    <div class="coordinate-box">X</div>
                    <span>‚Üí</span>
                    <span>First number = Left/Right</span>
                    <span style="margin: 0 10px;">‚Ä¢</span>
                    <div class="coordinate-box">Y</div>
                    <span>‚Üí</span>
                    <span>Second number = Up/Down</span>
                </div>
                <p>Example: (3, 5) means go 3 steps right and 5 steps up from the bottom-left corner!</p>
            </div>
        </div>

        <div class="level-indicator" id="levelIndicator">
            <div class="level-dot active" data-level="1">1</div>
            <div class="level-dot" data-level="2">2</div>
            <div class="level-dot" data-level="3">3</div>
        </div>

        <div class="score-container">
            <div>Score: <span id="score" class="score-item">0</span></div>
            <div>Level: <span id="currentLevel" class="score-item">1</span></div>
            <div>Questions: <span id="questionCount" class="score-item">1/5</span></div>
        </div>

        <div class="progress-container">
            <div class="progress-text">Level Progress</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="game-area" id="gameArea">
            <!-- Level 1: Treasure Hunt -->
            <div id="level1" class="game-content">
                <h2 class="game-title">üß≠ Level 1: Treasure Hunt</h2>
                
                <div class="mission-control">
                    <div class="mission-text">Find the Hidden Treasure!</div>
                    <div class="mission-objective" id="level1Objective">Find the treasure hidden somewhere on the map</div>
                </div>
                
                <div class="coordinate-guide">
                    <div class="guide-title">üéØ How to Read the Grid</div>
                    <div class="guide-text">
                        Look at the numbers on the sides! 
                        <span class="guide-example">X=<span id="guideX">?</span></span> is right/left, 
                        <span class="guide-example">Y=<span id="guideY">?</span></span> is up/down.
                        Find where they meet!
                    </div>
                </div>
                
                <div class="map-container" id="treasureMap">
                    <div class="grid-overlay"></div>
                    <div class="grid-coordinates">
                        <!-- X-axis labels (bottom) -->
                        <div class="x-coordinates">
                            <div class="x-label">1</div>
                            <div class="x-label">2</div>
                            <div class="x-label">3</div>
                            <div class="x-label">4</div>
                            <div class="x-label">5</div>
                            <div class="x-label">6</div>
                            <div class="x-label">7</div>
                            <div class="x-label">8</div>
                            <div class="x-label">9</div>
                            <div class="x-label">10</div>
                        </div>
                        
                        <!-- Y-axis labels (left) -->
                        <div class="y-coordinates">
                            <div class="y-label">10</div>
                            <div class="y-label">9</div>
                            <div class="y-label">8</div>
                            <div class="y-label">7</div>
                            <div class="y-label">6</div>
                            <div class="y-label">5</div>
                            <div class="y-label">4</div>
                            <div class="y-label">3</div>
                            <div class="y-label">2</div>
                            <div class="y-label">1</div>
                        </div>
                        
                        <!-- Highlight origin lines -->
                        <div class="origin-highlight"></div>
                        <div class="origin-highlight horizontal"></div>
                    </div>
                    
                    <!-- Cell labels will be added here -->
                </div>
                
                <div class="coordinate-input">
                    <span class="coord-label">X (Right/Left):</span>
                    <input type="number" class="coord-input" id="guessX" min="1" max="10" placeholder="1-10">
                    <span class="coord-label">Y (Up/Down):</span>
                    <input type="number" class="coord-input" id="guessY" min="1" max="10" placeholder="1-10">
                    <button class="action-btn" id="digTreasure">Dig Here!</button>
                </div>
                
                <div class="feedback" id="level1Feedback">Click on the map or enter coordinates to find the treasure!</div>
            </div>
            
            <!-- Level 2: Navigation Challenge -->
            <div id="level2" class="game-content" style="display: none;">
                <h2 class="game-title">üß≠ Level 2: Navigation Challenge</h2>
                
                <div class="mission-control">
                    <div class="mission-text">Navigate to the Target!</div>
                    <div class="mission-objective" id="level2Objective">Avoid obstacles and reach the target</div>
                </div>
                
                <div class="coordinate-guide">
                    <div class="guide-title">üéÆ Movement Guide</div>
                    <div class="guide-text">
                        Use arrows to move! Your position is <span class="guide-example" id="currentPosDisplay">(?, ?)</span>. 
                        Target is at <span class="guide-example" id="targetPosDisplay">(?, ?)</span>
                    </div>
                </div>
                
                <div class="navigation-container">
                    <div class="map-container" id="navMap">
                        <div class="grid-overlay"></div>
                        <div class="grid-coordinates">
                            <!-- X-axis labels (bottom) -->
                            <div class="x-coordinates">
                                <div class="x-label">1</div>
                                <div class="x-label">2</div>
                                <div class="x-label">3</div>
                                <div class="x-label">4</div>
                                <div class="x-label">5</div>
                                <div class="x-label">6</div>
                                <div class="x-label">7</div>
                                <div class="x-label">8</div>
                                <div class="x-label">9</div>
                                <div class="x-label">10</div>
                            </div>
                            
                            <!-- Y-axis labels (left) -->
                            <div class="y-coordinates">
                                <div class="y-label">10</div>
                                <div class="y-label">9</div>
                                <div class="y-label">8</div>
                                <div class="y-label">7</div>
                                <div class="y-label">6</div>
                                <div class="y-label">5</div>
                                <div class="y-label">4</div>
                                <div class="y-label">3</div>
                                <div class="y-label">2</div>
                                <div class="y-label">1</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="direction-controls">
                        <button class="dir-btn" data-direction="north">‚Üë Up (Y-1)</button>
                        <button class="dir-btn" data-direction="west">‚Üê Left (X-1)</button>
                        <div class="dir-btn">‚óè You</div>
                        <button class="dir-btn" data-direction="east">‚Üí Right (X+1)</button>
                        <button class="dir-btn" data-direction="south">‚Üì Down (Y+1)</button>
                    </div>
                </div>
                
                <div class="feedback" id="level2Feedback">Use the arrows to navigate to the target!</div>
            </div>
            
            <!-- Level 3: Animal Rescue (Simplified) -->
            <div id="level3" class="game-content" style="display: none;">
                <h2 class="game-title">üêæ Level 3: Animal Rescue</h2>
                
                <div class="mission-control">
                    <div class="mission-text">Rescue the Animals!</div>
                    <div class="mission-objective" id="level3Objective">Click on the correct coordinates to rescue each animal</div>
                </div>
                
                <div class="coordinate-guide">
                    <div class="guide-title">üê∂ Find the Animal!</div>
                    <div class="guide-text">
                        The animal is hiding at a secret location. Look at the grid and find where 
                        <span class="guide-example">X=<span id="animalX">?</span></span> and 
                        <span class="guide-example">Y=<span id="animalY">?</span></span> meet!
                    </div>
                </div>
                
                <div class="map-container" id="animalMap">
                    <div class="grid-overlay"></div>
                    <div class="grid-coordinates">
                        <!-- X-axis labels (bottom) -->
                        <div class="x-coordinates">
                            <div class="x-label">1</div>
                            <div class="x-label">2</div>
                            <div class="x-label">3</div>
                            <div class="x-label">4</div>
                            <div class="x-label">5</div>
                            <div class="x-label">6</div>
                            <div class="x-label">7</div>
                            <div class="x-label">8</div>
                            <div class="x-label">9</div>
                            <div class="x-label">10</div>
                        </div>
                        
                        <!-- Y-axis labels (left) -->
                        <div class="y-coordinates">
                            <div class="y-label">10</div>
                            <div class="y-label">9</div>
                            <div class="y-label">8</div>
                            <div class="y-label">7</div>
                            <div class="y-label">6</div>
                            <div class="y-label">5</div>
                            <div class="y-label">4</div>
                            <div class="y-label">3</div>
                            <div class="y-label">2</div>
                            <div class="y-label">1</div>
                        </div>
                    </div>
                </div>
                
                <div class="question-container">
                    <div class="question-text" id="animalQuestion">Where is the animal located?</div>
                    <div class="options-container" id="animalOptions">
                        <!-- Options will be generated here -->
                    </div>
                </div>
                
                <div class="feedback" id="level3Feedback">Click on the map or select an option to rescue the animal!</div>
            </div>
            
            <!-- Level Complete Screen -->
            <div id="levelComplete" class="level-complete" style="display: none;">
                <h2>üéâ Level Complete! üéâ</h2>
                <div class="level-score">
                    <p>Level Score: <span id="levelScore">0</span> points</p>
                    <p>Questions Correct: <span id="levelCorrect">0</span>/5</p>
                    <p>Total Score: <span id="totalScore">0</span> points</p>
                </div>
                <button class="action-btn" id="nextLevel">Next Level</button>
            </div>
            
            <!-- Game Complete Screen -->
            <div id="gameComplete" class="game-complete" style="display: none;">
                <h2>üèÜ Adventure Complete! üèÜ</h2>
                <h3>You've mastered all levels!</h3>
                
                <div class="final-score">
                    <p>Final Score: <span id="finalScore">0</span></p>
                    <p>Levels Completed: <span id="levelsCompleted">3</span></p>
                </div>
                
                <div class="level-breakdown">
                    <p>Level 1 Score: <span id="level1Score">0</span></p>
                    <p>Level 2 Score: <span id="level2Score">0</span></p>
                    <p>Level 3 Score: <span id="level3Score">0</span></p>
                </div>
                
                <button class="action-btn" id="restartGame">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let currentLevel = 1;
        let totalScore = 0;
        let levelScores = [0, 0, 0];
        let currentQuestion = 1;
        let questionsPerLevel = 5;
        let questionsCorrect = 0;
        let currentPosition = { x: 1, y: 1 };
        let targetPosition = {};
        let levelCompleted = false;
        
        // DOM elements
        const levelDots = document.querySelectorAll('.level-dot');
        const scoreElement = document.getElementById('score');
        const currentLevelElement = document.getElementById('currentLevel');
        const questionCountElement = document.getElementById('questionCount');
        const progressFillElement = document.getElementById('progressFill');
        
        // Initialize the game
        function init() {
            // Set up level indicator
            levelDots.forEach(dot => {
                dot.addEventListener('click', function() {
                    if (parseInt(this.dataset.level) <= currentLevel) {
                        switchLevel(parseInt(this.dataset.level));
                    }
                });
            });
            
            // Set up level 1
            setupLevel1();
            
            // Set up level 2
            setupLevel2();
            
            // Set up level 3
            setupLevel3();
            
            // Start with level 1
            switchLevel(1);
        }
        
        // Switch between levels
        function switchLevel(level) {
            if (levelCompleted) return;
            
            currentLevel = level;
            currentLevelElement.textContent = level;
            
            // Reset question counter
            currentQuestion = 1;
            questionsCorrect = 0;
            updateQuestionCount();
            updateProgressBar();
            
            // Hide all levels and screens
            document.querySelectorAll('.game-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Show selected level
            document.getElementById(`level${level}`).style.display = 'block';
            
            // Update level indicator
            updateLevelIndicator();
            
            // Generate first question for this level
            generateLevelQuestion();
        }
        
        // Update level indicator dots
        function updateLevelIndicator() {
            levelDots.forEach(dot => {
                const dotLevel = parseInt(dot.dataset.level);
                
                dot.classList.remove('active', 'completed');
                
                if (dotLevel === currentLevel) {
                    dot.classList.add('active');
                } else if (dotLevel < currentLevel) {
                    dot.classList.add('completed');
                }
            });
        }
        
        // Update question counter
        function updateQuestionCount() {
            questionCountElement.textContent = `${currentQuestion}/${questionsPerLevel}`;
        }
        
        // Update progress bar
        function updateProgressBar() {
            const progress = ((currentQuestion - 1) / questionsPerLevel) * 100;
            progressFillElement.style.width = `${progress}%`;
        }
        
        // Add cell labels to grid
        function addGridLabels(mapId) {
            const map = document.getElementById(mapId);
            
            // Remove existing cell labels
            map.querySelectorAll('.cell-label').forEach(label => label.remove());
            
            // Add cell labels for each grid cell
            for (let x = 1; x <= 10; x++) {
                for (let y = 1; y <= 10; y++) {
                    const cellLabel = document.createElement('div');
                    cellLabel.className = 'cell-label';
                    cellLabel.textContent = `(${x},${y})`;
                    cellLabel.style.left = `${(x - 1) * 50 + 15}px`;
                    cellLabel.style.top = `${(y - 1) * 35 + 8}px`;
                    map.appendChild(cellLabel);
                }
            }
        }
        
        // Generate a new question for current level
        function generateLevelQuestion() {
            if (currentLevel === 1) {
                generateTreasureQuestion();
                addGridLabels('treasureMap');
            } else if (currentLevel === 2) {
                generateNavigationQuestion();
                addGridLabels('navMap');
            } else if (currentLevel === 3) {
                generateAnimalQuestion();
                addGridLabels('animalMap');
            }
            
            updateQuestionCount();
            updateProgressBar();
        }
        
        /* ----- LEVEL 1: TREASURE HUNT (5 questions) ----- */
        function setupLevel1() {
            const treasureMap = document.getElementById('treasureMap');
            const digBtn = document.getElementById('digTreasure');
            
            // Click on map to guess coordinates
            treasureMap.addEventListener('click', (e) => {
                if (levelCompleted) return;
                
                const rect = treasureMap.getBoundingClientRect();
                const x = Math.floor((e.clientX - rect.left) / (rect.width / 10)) + 1;
                const y = Math.floor((e.clientY - rect.top) / (rect.height / 10)) + 1;
                
                if (x >= 1 && x <= 10 && y >= 1 && y <= 10) {
                    document.getElementById('guessX').value = x;
                    document.getElementById('guessY').value = y;
                    document.getElementById('guideX').textContent = x;
                    document.getElementById('guideY').textContent = y;
                    
                    // Highlight the clicked cell
                    highlightCell(treasureMap, x, y);
                    
                    checkTreasureGuess(x, y);
                }
            });
            
            // Dig button
            digBtn.addEventListener('click', () => {
                if (levelCompleted) return;
                
                const x = parseInt(document.getElementById('guessX').value);
                const y = parseInt(document.getElementById('guessY').value);
                
                if (x >= 1 && x <= 10 && y >= 1 && y <= 10) {
                    document.getElementById('guideX').textContent = x;
                    document.getElementById('guideY').textContent = y;
                    
                    // Highlight the selected cell
                    highlightCell(treasureMap, x, y);
                    
                    checkTreasureGuess(x, y);
                } else {
                    showFeedback('level1Feedback', 'Please enter numbers between 1 and 10!', false);
                }
            });
        }
        
        function highlightCell(map, x, y) {
            // Remove previous highlights
            map.querySelectorAll('.cell-highlight').forEach(h => h.remove());
            
            // Add highlight
            const highlight = document.createElement('div');
            highlight.className = 'cell-highlight';
            highlight.style.position = 'absolute';
            highlight.style.left = `${(x - 1) * 50 + 2}px`;
            highlight.style.top = `${(y - 1) * 35 + 2}px`;
            highlight.style.width = '46px';
            highlight.style.height = '31px';
            highlight.style.backgroundColor = 'rgba(255, 255, 0, 0.3)';
            highlight.style.border = '2px solid #ffd700';
            highlight.style.borderRadius = '5px';
            highlight.style.zIndex = '5';
            map.appendChild(highlight);
        }
        
        function generateTreasureQuestion() {
            const treasureMap = document.getElementById('treasureMap');
            
            // Clear previous items
            treasureMap.querySelectorAll('.location-item').forEach(item => item.remove());
            treasureMap.querySelectorAll('.cell-highlight').forEach(h => h.remove());
            
            // Set random treasure position
            targetPosition = {
                x: Math.floor(Math.random() * 10) + 1,
                y: Math.floor(Math.random() * 10) + 1
            };
            
            // Update mission
            document.getElementById('level1Objective').textContent = 
                `Question ${currentQuestion}/5: Find the treasure at (${targetPosition.x}, ${targetPosition.y})`;
            
            // Update guide
            document.getElementById('guideX').textContent = '?';
            document.getElementById('guideY').textContent = '?';
            
            // Clear input fields
            document.getElementById('guessX').value = '';
            document.getElementById('guessY').value = '';
            
            showFeedback('level1Feedback', `Question ${currentQuestion}: Look at the grid and find (${targetPosition.x}, ${targetPosition.y})!`, true);
        }
        
        function checkTreasureGuess(x, y) {
            const distance = Math.abs(x - targetPosition.x) + Math.abs(y - targetPosition.y);
            
            if (distance === 0) {
                // Found treasure!
                questionsCorrect++;
                showFeedback('level1Feedback', `üéâ Correct! You found the treasure at (${x}, ${y})!`, true);
                
                // Add treasure to map
                const treasureMap = document.getElementById('treasureMap');
                const treasure = document.createElement('div');
                treasure.className = 'location-item treasure pulse';
                treasure.style.left = `${(x - 1) * 50 + 25}px`;
                treasure.style.top = `${(y - 1) * 35 + 17}px`;
                treasure.innerHTML = 'üí∞';
                treasureMap.appendChild(treasure);
                
                // Update score
                const points = 20;
                totalScore += points;
                levelScores[0] += points;
                scoreElement.textContent = totalScore;
                
                // Next question or complete level
                setTimeout(() => {
                    if (currentQuestion < questionsPerLevel) {
                        currentQuestion++;
                        generateTreasureQuestion();
                    } else {
                        completeLevel();
                    }
                }, 1500);
            } else {
                // Give hints
                let message;
                if (distance === 1) message = 'So close! Just one step away!';
                else if (distance <= 3) message = 'You\'re getting warm!';
                else message = 'Not quite. Try again!';
                
                showFeedback('level1Feedback', `${message} Treasure is at (${targetPosition.x}, ${targetPosition.y})`, false);
            }
        }
        
        /* ----- LEVEL 2: NAVIGATION CHALLENGE (5 questions) ----- */
        function setupLevel2() {
            const dirBtns = document.querySelectorAll('.dir-btn[data-direction]');
            
            // Direction buttons
            dirBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (levelCompleted) return;
                    movePlayer(btn.getAttribute('data-direction'));
                });
            });
        }
        
        function generateNavigationQuestion() {
            const navMap = document.getElementById('navMap');
            
            // Clear previous items
            navMap.querySelectorAll('.location-item').forEach(item => item.remove());
            
            // Set random start position
            currentPosition = {
                x: Math.floor(Math.random() * 8) + 2,
                y: Math.floor(Math.random() * 8) + 2
            };
            
            // Set target position (3-6 steps away)
            do {
                targetPosition = {
                    x: Math.floor(Math.random() * 10) + 1,
                    y: Math.floor(Math.random() * 10) + 1
                };
            } while (Math.abs(targetPosition.x - currentPosition.x) + Math.abs(targetPosition.y - currentPosition.y) < 3 ||
                     Math.abs(targetPosition.x - currentPosition.x) + Math.abs(targetPosition.y - currentPosition.y) > 6);
            
            // Add player
            const player = document.createElement('div');
            player.className = 'location-item player pulse';
            player.id = 'navPlayer';
            player.style.left = `${(currentPosition.x - 1) * 50 + 25}px`;
            player.style.top = `${(currentPosition.y - 1) * 35 + 17}px`;
            player.innerHTML = 'üß≠';
            navMap.appendChild(player);
            
            // Add target
            const target = document.createElement('div');
            target.className = 'location-item treasure';
            target.style.left = `${(targetPosition.x - 1) * 50 + 25}px`;
            target.style.top = `${(targetPosition.y - 1) * 35 + 17}px`;
            target.innerHTML = 'üéØ';
            navMap.appendChild(target);
            
            // Add 3 obstacles
            for (let i = 0; i < 3; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * 10) + 1;
                    y = Math.floor(Math.random() * 10) + 1;
                } while ((x === currentPosition.x && y === currentPosition.y) || 
                        (x === targetPosition.x && y === targetPosition.y) ||
                        (Math.abs(x - currentPosition.x) <= 1 && Math.abs(y - currentPosition.y) <= 1));
                
                const obstacle = document.createElement('div');
                obstacle.className = 'location-item obstacle';
                obstacle.style.left = `${(x - 1) * 50 + 25}px`;
                obstacle.style.top = `${(y - 1) * 35 + 17}px`;
                obstacle.innerHTML = 'üöß';
                obstacle.title = `Obstacle at (${x}, ${y})`;
                navMap.appendChild(obstacle);
            }
            
            // Update mission
            document.getElementById('level2Objective').textContent = 
                `Question ${currentQuestion}/5: Navigate from (${currentPosition.x}, ${currentPosition.y}) to (${targetPosition.x}, ${targetPosition.y})`;
            
            // Update position displays
            document.getElementById('currentPosDisplay').textContent = `(${currentPosition.x}, ${currentPosition.y})`;
            document.getElementById('targetPosDisplay').textContent = `(${targetPosition.x}, ${targetPosition.y})`;
            
            showFeedback('level2Feedback', `Question ${currentQuestion}: Use arrows to navigate! You are at (${currentPosition.x}, ${currentPosition.y})`, true);
        }
        
        function movePlayer(direction) {
            let newX = currentPosition.x;
            let newY = currentPosition.y;
            
            switch(direction) {
                case 'north': newY = Math.max(1, currentPosition.y - 1); break;
                case 'east': newX = Math.min(10, currentPosition.x + 1); break;
                case 'south': newY = Math.min(10, currentPosition.y + 1); break;
                case 'west': newX = Math.max(1, currentPosition.x - 1); break;
            }
            
            // Check for obstacles
            const obstacles = document.querySelectorAll('#navMap .obstacle');
            let canMove = true;
            
            obstacles.forEach(obstacle => {
                const obstacleX = Math.round((parseInt(obstacle.style.left) - 25) / 50) + 1;
                const obstacleY = Math.round((parseInt(obstacle.style.top) - 17) / 35) + 1;
                
                if (obstacleX === newX && obstacleY === newY) {
                    canMove = false;
                    showFeedback('level2Feedback', `Cannot move to (${newX}, ${newY})! There's an obstacle.`, false);
                }
            });
            
            if (canMove) {
                currentPosition.x = newX;
                currentPosition.y = newY;
                
                const player = document.getElementById('navPlayer');
                player.style.left = `${(currentPosition.x - 1) * 50 + 25}px`;
                player.style.top = `${(currentPosition.y - 1) * 35 + 17}px`;
                
                // Update position display
                document.getElementById('currentPosDisplay').textContent = `(${currentPosition.x}, ${currentPosition.y})`;
                
                // Check if reached target
                if (currentPosition.x === targetPosition.x && currentPosition.y === targetPosition.y) {
                    questionsCorrect++;
                    showFeedback('level2Feedback', `üéâ Perfect! You reached the target at (${targetPosition.x}, ${targetPosition.y})!`, true);
                    
                    // Update score
                    const points = 25;
                    totalScore += points;
                    levelScores[1] += points;
                    scoreElement.textContent = totalScore;
                    
                    // Next question or complete level
                    setTimeout(() => {
                        if (currentQuestion < questionsPerLevel) {
                            currentQuestion++;
                            generateNavigationQuestion();
                        } else {
                            completeLevel();
                        }
                    }, 1500);
                } else {
                    const distance = Math.abs(currentPosition.x - targetPosition.x) + Math.abs(currentPosition.y - targetPosition.y);
                    let hint = '';
                    if (distance <= 3) hint = ' Getting close!';
                    showFeedback('level2Feedback', `Position: (${currentPosition.x}, ${currentPosition.y})${hint}`, true);
                }
            }
        }
        
        /* ----- LEVEL 3: ANIMAL RESCUE (Simplified - 5 questions) ----- */
        function setupLevel3() {
            const animalMap = document.getElementById('animalMap');
            
            // Click on map to guess coordinates
            animalMap.addEventListener('click', (e) => {
                if (levelCompleted) return;
                
                const rect = animalMap.getBoundingClientRect();
                const x = Math.floor((e.clientX - rect.left) / (rect.width / 10)) + 1;
                const y = Math.floor((e.clientY - rect.top) / (rect.height / 10)) + 1;
                
                if (x >= 1 && x <= 10 && y >= 1 && y <= 10) {
                    highlightCell(animalMap, x, y);
                    checkAnimalGuess(x, y);
                }
            });
        }
        
        function generateAnimalQuestion() {
            const animalMap = document.getElementById('animalMap');
            const optionsContainer = document.getElementById('animalOptions');
            
            // Clear previous items
            animalMap.querySelectorAll('.location-item').forEach(item => item.remove());
            animalMap.querySelectorAll('.cell-highlight').forEach(h => h.remove());
            optionsContainer.innerHTML = '';
            
            // Set random animal position
            targetPosition = {
                x: Math.floor(Math.random() * 10) + 1,
                y: Math.floor(Math.random() * 10) + 1
            };
            
            // Create animal
            const animals = ['üê±', 'üê∂', 'üê∞', 'üêª', 'üêº', 'üê®', 'ü¶ä', 'üêØ'];
            const currentAnimal = animals[Math.floor(Math.random() * animals.length)];
            
            const animal = document.createElement('div');
            animal.className = 'location-item animal';
            animal.style.left = `${(targetPosition.x - 1) * 50 + 25}px`;
            animal.style.top = `${(targetPosition.y - 1) * 35 + 17}px`;
            animal.innerHTML = currentAnimal;
            animal.title = `Find me at (${targetPosition.x}, ${targetPosition.y})`;
            animalMap.appendChild(animal);
            
            // Update question and guide
            document.getElementById('animalQuestion').textContent = 
                `Question ${currentQuestion}/5: Where is the ${getAnimalName(currentAnimal)} located?`;
            
            document.getElementById('animalX').textContent = targetPosition.x;
            document.getElementById('animalY').textContent = targetPosition.y;
            
            // Generate 4 options (1 correct, 3 wrong)
            const options = [];
            options.push(`(${targetPosition.x}, ${targetPosition.y})`); // Correct
            
            // Add 3 wrong options
            for (let i = 0; i < 3; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * 10) + 1;
                    y = Math.floor(Math.random() * 10) + 1;
                } while (x === targetPosition.x && y === targetPosition.y);
                options.push(`(${x}, ${y})`);
            }
            
            // Shuffle options
            shuffleArray(options);
            
            // Create option buttons
            options.forEach(option => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.textContent = option;
                optionBtn.addEventListener('click', () => {
                    const selectedX = parseInt(option.split(',')[0].replace('(', ''));
                    const selectedY = parseInt(option.split(',')[1].replace(')', ''));
                    highlightCell(animalMap, selectedX, selectedY);
                    checkAnimalGuess(selectedX, selectedY);
                });
                optionsContainer.appendChild(optionBtn);
            });
            
            // Update mission
            document.getElementById('level3Objective').textContent = 
                `Click on the map or select an option to rescue the ${getAnimalName(currentAnimal)}`;
            
            showFeedback('level3Feedback', `Question ${currentQuestion}: Find the ${getAnimalName(currentAnimal)} at (${targetPosition.x}, ${targetPosition.y})!`, true);
        }
        
        function getAnimalName(emoji) {
            const animalNames = {
                'üê±': 'cat',
                'üê∂': 'dog',
                'üê∞': 'rabbit',
                'üêª': 'bear',
                'üêº': 'panda',
                'üê®': 'koala',
                'ü¶ä': 'fox',
                'üêØ': 'tiger'
            };
            return animalNames[emoji] || 'animal';
        }
        
        function checkAnimalGuess(x, y) {
            if (x === targetPosition.x && y === targetPosition.y) {
                // Correct guess
                questionsCorrect++;
                showFeedback('level3Feedback', `üéâ Great job! You rescued the animal at (${x}, ${y})!`, true);
                
                // Update score
                const points = 30;
                totalScore += points;
                levelScores[2] += points;
                scoreElement.textContent = totalScore;
                
                // Highlight correct option
                const options = document.querySelectorAll('.option-btn');
                options.forEach(option => {
                    if (option.textContent === `(${targetPosition.x}, ${targetPosition.y})`) {
                        option.classList.add('correct');
                    }
                    option.disabled = true;
                });
                
                // Next question or complete level
                setTimeout(() => {
                    if (currentQuestion < questionsPerLevel) {
                        currentQuestion++;
                        generateAnimalQuestion();
                    } else {
                        completeLevel(true); // true = final level
                    }
                }, 1500);
            } else {
                // Wrong guess
                showFeedback('level3Feedback', `Not quite. The animal is at (${targetPosition.x}, ${targetPosition.y})`, false);
                
                // Highlight wrong option
                const options = document.querySelectorAll('.option-btn');
                options.forEach(option => {
                    if (option.textContent === `(${x}, ${y})`) {
                        option.classList.add('wrong');
                    }
                    if (option.textContent === `(${targetPosition.x}, ${targetPosition.y})`) {
                        option.classList.add('correct');
                    }
                    option.disabled = true;
                });
                
                // Next question after delay
                setTimeout(() => {
                    if (currentQuestion < questionsPerLevel) {
                        currentQuestion++;
                        generateAnimalQuestion();
                    } else {
                        completeLevel(true); // true = final level
                    }
                }, 2000);
            }
        }
        
        /* ----- LEVEL COMPLETION ----- */
        function completeLevel(isFinalLevel = false) {
            levelCompleted = true;
            
            // Hide current level
            document.getElementById(`level${currentLevel}`).style.display = 'none';
            
            if (isFinalLevel) {
                // Show game complete screen
                showGameComplete();
            } else {
                // Show level complete screen
                document.getElementById('levelComplete').style.display = 'block';
                document.getElementById('levelScore').textContent = levelScores[currentLevel - 1];
                document.getElementById('levelCorrect').textContent = questionsCorrect;
                document.getElementById('totalScore').textContent = totalScore;
                
                // Set up next level button
                document.getElementById('nextLevel').onclick = function() {
                    levelCompleted = false;
                    document.getElementById('levelComplete').style.display = 'none';
                    switchLevel(currentLevel + 1);
                };
            }
        }
        
        /* ----- GAME COMPLETION ----- */
        function showGameComplete() {
            document.getElementById('gameComplete').style.display = 'block';
            document.getElementById('finalScore').textContent = totalScore;
            document.getElementById('level1Score').textContent = levelScores[0];
            document.getElementById('level2Score').textContent = levelScores[1];
            document.getElementById('level3Score').textContent = levelScores[2];
            
            // Add celebration animation
            document.querySelector('.game-complete h2').classList.add('celebration');
            
            // Set up restart button
            document.getElementById('restartGame').onclick = restartGame;
        }
        
        /* ----- GAME RESTART ----- */
        function restartGame() {
            // Reset game state
            currentLevel = 1;
            totalScore = 0;
            levelScores = [0, 0, 0];
            currentQuestion = 1;
            questionsCorrect = 0;
            levelCompleted = false;
            
            // Update UI
            scoreElement.textContent = '0';
            currentLevelElement.textContent = '1';
            updateQuestionCount();
            updateProgressBar();
            
            // Remove celebration animation
            document.querySelector('.game-complete h2').classList.remove('celebration');
            
            // Hide game complete screen
            document.getElementById('gameComplete').style.display = 'none';
            
            // Restart from level 1
            switchLevel(1);
        }
        
        /* ----- HELPER FUNCTIONS ----- */
        function showFeedback(elementId, message, isCorrect) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Start the game when page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>